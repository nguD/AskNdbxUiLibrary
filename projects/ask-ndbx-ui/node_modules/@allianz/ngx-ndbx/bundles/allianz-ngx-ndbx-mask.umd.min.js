!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@angular/core"),require("@allianz/ngx-ndbx/formfield"),require("@angular/forms"),require("@angular/cdk/coercion"),require("@allianz/ngx-ndbx/input"),require("@angular/cdk/keycodes"),require("rxjs"),require("iban")):"function"==typeof define&&define.amd?define("@allianz/ngx-ndbx/mask",["exports","@angular/common","@angular/core","@allianz/ngx-ndbx/formfield","@angular/forms","@angular/cdk/coercion","@allianz/ngx-ndbx/input","@angular/cdk/keycodes","rxjs","iban"],e):e(((t=t||self).allianz=t.allianz||{},t.allianz["ngx-ndbx"]=t.allianz["ngx-ndbx"]||{},t.allianz["ngx-ndbx"].mask={}),t.ng.common,t.ng.core,t.allianz["ngx-ndbx"].formfield,t.ng.forms,t.ng.cdk.coercion,t.allianz["ngx-ndbx"].input,t.ng.cdk.keycodes,t.rxjs,t.iban)}(this,function(t,e,n,r,i,a,s,o,l,u){"use strict";var c={provide:i.NG_VALUE_ACCESSOR,useExisting:n.forwardRef(function(){return p}),multi:!0},h={provide:i.NG_VALIDATORS,useExisting:n.forwardRef(function(){return p}),multi:!0};var p=function(){function t(t){this._elementRef=t,this._separators=["/","(",")",".",":","-"," ","+",","],this._dropSpecialCharacters=!1,this._validateMask=!0,this.cvaModelChange=new l.Subject,this._onChangeCallback=function(t){},this._onTouchedCallback=function(){},this._validatorOnChange=function(){},this._afterInputHook=function(t){},this._beforePasteHook=function(t){}}return t.prototype._callOnChangeCallback=function(){this.dropSpecialCharacters?this._onChangeCallback(this.getUnmaskedValue()):this._onChangeCallback(this._elementRef.nativeElement.value)},t.prototype.registerAfterInputHook=function(t){this._afterInputHook=t},t.prototype.registerBeforePasteHook=function(t){this._beforePasteHook=t},Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(t){t||(t=""),t!==this._mask&&(this._mask=t,this.updateValue(this.getMaskedString(this._elementRef.nativeElement.value)),this._callOnChangeCallback(),this._validatorOnChange())},enumerable:!0,configurable:!0}),t.prototype.setMask=function(t){t||(t=""),t!==this._mask&&(this._mask=t,this.updateValue(this.getMaskedString(this._elementRef.nativeElement.value)),this._validatorOnChange())},Object.defineProperty(t.prototype,"convertTo",{get:function(){return this._convertTo},set:function(t){this._convertTo=t,this.updateValue(this.getMaskedString(this._elementRef.nativeElement.value)),this._callOnChangeCallback()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"separators",{get:function(){return this._separators},set:function(t){this._separators=t,this.updateValue(this.getMaskedString(this._elementRef.nativeElement.value)),this._validatorOnChange(),this._callOnChangeCallback()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropSpecialCharacters",{get:function(){return this._dropSpecialCharacters},set:function(t){var e=a.coerceBooleanProperty(t);e!==this._dropSpecialCharacters&&(this._dropSpecialCharacters=e,this.updateValue(this.getMaskedString(this._elementRef.nativeElement.value)),this._callOnChangeCallback())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"validateMask",{get:function(){return this._validateMask},set:function(t){var e=a.coerceBooleanProperty(t);e!==this._validateMask&&(this._validateMask=e,this._validatorOnChange())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elementRefValue",{get:function(){return this._elementRef.nativeElement.value},enumerable:!0,configurable:!0}),t.prototype.getUnmaskedValue=function(){return this.separators.reduce(function(t,e){return t.split(e).join("")},this._elementRef.nativeElement.value)},t.prototype._onKeydown=function(t){var e=t.keyCode,n=t.target,r=this._elementRef.nativeElement.value;if(e===o.BACKSPACE||e===o.DELETE){var i=e===o.BACKSPACE?1:0,a=r.substring(n.selectionStart-i,n.selectionEnd-i+1),s=n.selectionStart===r.length-1+i;if(n.selectionStart!==n.selectionEnd){for(var l=n.selectionStart;this.isSeparator(this.mask[l]);)l++;this._cursor={position:l}}else s?(this.updateValue(r.substring(0,r.length-1)),this._callOnChangeCallback(),t.preventDefault()):this.isSeparator(a)?(n.setSelectionRange(n.selectionStart-i,n.selectionEnd-i),t.preventDefault()):this._cursor={position:n.selectionStart-i}}else this._cursor={selectionStart:n.selectionStart,selectionEnd:n.selectionEnd}},t.prototype._calculateCursorShift=function(t){var e=0,n=!1;for(this.isSeparator(this.mask[t+e])||(e++,n=!0);this.isSeparator(this.mask[t+e]);)e++;return n||e++,e},t.prototype._isStringAllowed=function(t,e){return!!("0"===e&&/^[0-9]{1}$/.test(t)||"A"===e&&/^[a-zA-Z0-9]{1}$/.test(t)||"S"===e&&/^[a-zA-Z]{1}$/.test(t))},t.prototype._onInputChange=function(t){var e=this._inputValue,n=t.target,r=this.getMaskedString(n.value);if(this._pastedData)return this.updateValue(this._pastedData),n.setSelectionRange(this._cursor.position,this._cursor.position),this._pastedData=null,this._cursor=null,void this._callOnChangeCallback();if(e.length===this._mask.length&&r.length===this._mask.length&&e!==r&&this._cursor&&void 0!==this._cursor.selectionStart&&this._cursor.selectionStart===this._cursor.selectionEnd)return this._elementRef.nativeElement.value=this.getMaskedString(e),n.setSelectionRange(this._cursor.selectionStart,this._cursor.selectionEnd),void(this._cursor=null);if(this.updateValue(r),this._cursor&&void 0!==this._cursor.position)n.setSelectionRange(this._cursor.position,this._cursor.position),this._cursor=null;else if(this._cursor&&void 0!==this._cursor.selectionStart)if(e!==n.value){var i=this._cursor.selectionStart+this._calculateCursorShift(this._cursor.selectionStart);n.setSelectionRange(i,i),this._cursor=null}else{for(var a=this._cursor.selectionStart;this.isSeparator(this.mask[a]);)a++;n.setSelectionRange(a,a),this._cursor=null}this._afterInputHook(t),this._callOnChangeCallback()},t.prototype._onPaste=function(t){var e=t.target,n=(t.clipboardData||window.clipboardData).getData("text"),r=e.selectionStart,i=e.selectionEnd,a=e.value;this._beforePasteHook(t);var s=this.getMaskedString(n,r);if(e.value.length===this._mask.length&&s.length>0&&r===i)return e.setSelectionRange(r,i),this._cursor=null,void t.preventDefault();var o=this.separators.reduce(function(t,e){return t.split(e).join("")},s),l=this.getMaskedString(a.substring(0,r)+o+a.substring(i,a.length));if(l.length>=this._mask.length){var u=r,c=1;do{l=this.getMaskedString(a.substring(0,r)+o.substring(0,c)+a.substring(i,a.length)),u+=this._calculateCursorShift(u),c++}while(l.length<this._mask.length);return this._pastedData=l,void(this._cursor={position:u})}this._cursor={position:r+s.length}},t.prototype.updateValue=function(t){"upper"===this._convertTo?t=t.toUpperCase():"lower"===this._convertTo&&(t=t.toLowerCase()),this._elementRef.nativeElement.value=t,this._inputValue=t},t.prototype.getMaskedString=function(t,e){void 0===e&&(e=0);for(var n="",r=e,i=0;this.isSeparator(this.mask[r]);)n+=this.mask[r],r++;for(;i<t.length;)for(this._isStringAllowed(t[i],this.mask[r])?(n+=t[i],i++,r++):i++;this.isSeparator(this.mask[r]);)n+=this.mask[r],r++;return n},t.prototype.isSeparator=function(t){return-1!==this._separators.indexOf(t)},t.prototype.writeValue=function(t){t||(t=""),this.cvaModelChange.next(t),this.updateValue(this.getMaskedString(t))},t.prototype.registerOnChange=function(t){this._onChangeCallback=t},t.prototype.registerOnTouched=function(t){this._onTouchedCallback=t},t.prototype.registerOnValidatorChange=function(t){this._validatorOnChange=t},t.prototype._validateFn=function(){var t=this._elementRef.nativeElement.value.length,e=this._mask.length;return t!==e?{nxMaskLengthError:{length:e,actual:t}}:null},t.prototype.validate=function(){return this.validateMask?this._validateFn():null},t.prototype._touch=function(){this._onTouchedCallback()},t.decorators=[{type:n.Directive,args:[{selector:"input[nxMask]",host:{"(input)":"_onInputChange($event)","(keydown)":"_onKeydown($event)","(paste)":"_onPaste($event)","(blur)":"_touch()"},exportAs:"nxMaskDirective",providers:[c,{provide:s.NX_INPUT_VALUE_ACCESSOR,useExisting:t},h]}]}],t.ctorParameters=function(){return[{type:n.ElementRef}]},t.propDecorators={mask:[{type:n.Input,args:["nxMask"]}],convertTo:[{type:n.Input,args:["nxConvertTo"]}],separators:[{type:n.Input}],dropSpecialCharacters:[{type:n.Input}],validateMask:[{type:n.Input}]},t}();var d={provide:i.NG_VALIDATORS,useExisting:n.forwardRef(function(){return g}),multi:!0},g=function(){function t(t,e){var n=this;this._elementRef=t,this.maskDirective=e,this._afterInputHook=function(t){var e=t.target;n._setCountryCode(e.value.substr(0,2))},this._beforePasteHook=function(t){var e=t.target,r=(t.clipboardData||window.clipboardData).getData("text"),i=(n.maskDirective.elementRefValue.substr(0,e.selectionStart)+n.maskDirective.getMaskedString(r,e.selectionStart)).substr(0,2);n._setCountryCode(i)},this.maskDirective.registerAfterInputHook(this._afterInputHook),this.maskDirective.registerBeforePasteHook(this._beforePasteHook),this.maskDirective.cvaModelChange.subscribe(function(t){var e=n.maskDirective.getMaskedString(t).substr(0,2);n._setCountryCode(e)})}return t.prototype._setCountryCode=function(t){2===(t=t.toUpperCase()).length&&this._countryCode!==t&&(this._countryCodeExists(t)?(this._countryCode=t,this.maskDirective.setMask(this._getMask(this._countryCode))):(this._countryCode=null,this.maskDirective.setMask("SS")))},t.prototype.ngOnInit=function(){this.maskDirective.mask="SS",this.maskDirective.convertTo="upper"},t.prototype._getMask=function(t){var e=u.countries[t],n="SS00";return e.structure.match(/.{1,3}/g).forEach(function(t){var e=t[0],r=Number(t.substring(1,3));switch(e){case"F":n+="0".repeat(r);break;case"A":n+="A".repeat(r);break;case"U":n+="S".repeat(r)}}),n=n.match(/.{1,4}/g).join(" ")},t.prototype._countryCodeExists=function(t){return!!u.countries[t]},t.prototype._validateFn=function(){var t=this._elementRef.nativeElement.value.substr(0,2);return 2!==t.length||this._countryCodeExists(t)?u.isValid(this.maskDirective.getUnmaskedValue())?null:{nxIbanParseError:"no valid iban"}:(this.maskDirective._touch(),{nxIbanInvalidCountryError:"no valid country code"})},t.prototype.validate=function(){return this.maskDirective.validateMask?this._validateFn():null},t.decorators=[{type:n.Directive,args:[{selector:"input[nxIbanMask]",exportAs:"nxIbanMaskDirective",providers:[d]}]}],t.ctorParameters=function(){return[{type:n.ElementRef},{type:p,decorators:[{type:n.Inject,args:[n.forwardRef(function(){return p})]}]}]},t}();var f=function(){function t(){}return t.decorators=[{type:n.NgModule,args:[{imports:[e.CommonModule,r.NxFormfieldModule],declarations:[p,g],exports:[r.NxFormfieldModule,p,g]}]}],t}();t.NX_IBAN_MASK_VALIDATORS=d,t.NX_MASK_VALIDATORS=h,t.NX_MASK_VALUE_ACCESSOR=c,t.NxIbanMaskDirective=g,t.NxMaskDirective=p,t.NxMaskModule=f,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=allianz-ngx-ndbx-mask.umd.min.js.map