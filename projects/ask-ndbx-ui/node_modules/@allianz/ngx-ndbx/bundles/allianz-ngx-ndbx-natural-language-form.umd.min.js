!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@allianz/ngx-ndbx/popover"),require("@allianz/ngx-ndbx/input"),require("@allianz/ngx-ndbx/formfield"),require("@allianz/ngx-ndbx/utils"),require("@angular/cdk/overlay"),require("@angular/core"),require("rxjs/operators"),require("rxjs"),require("@allianz/ngx-ndbx/dropdown"),require("@angular/cdk/portal"),require("@angular/cdk/coercion"),require("@angular/common")):"function"==typeof define&&define.amd?define("@allianz/ngx-ndbx/natural-language-form",["exports","@allianz/ngx-ndbx/popover","@allianz/ngx-ndbx/input","@allianz/ngx-ndbx/formfield","@allianz/ngx-ndbx/utils","@angular/cdk/overlay","@angular/core","rxjs/operators","rxjs","@allianz/ngx-ndbx/dropdown","@angular/cdk/portal","@angular/cdk/coercion","@angular/common"],t):t(((e=e||self).allianz=e.allianz||{},e.allianz["ngx-ndbx"]=e.allianz["ngx-ndbx"]||{},e.allianz["ngx-ndbx"]["natural-language-form"]={}),e.allianz["ngx-ndbx"].popover,e.allianz["ngx-ndbx"].input,e.allianz["ngx-ndbx"].formfield,e.allianz["ngx-ndbx"].utils,e.ng.cdk.overlay,e.ng.core,e.rxjs.operators,e.rxjs,e.allianz["ngx-ndbx"].dropdown,e.ng.cdk.portal,e.ng.cdk.coercion,e.ng.common)}(this,function(e,t,n,r,o,i,a,s,l,p,d,h,g){"use strict";function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}var u=function(){function e(e,t,n,r,o,i){this.elementRef=e,this._changeDetectorRef=t,this._renderer=n,this._overlay=r,this._viewContainerRef=o,this._overlayPositionBuilder=i,this.subscription=l.Subscription.EMPTY,this.subscriptionValues=l.Subscription.EMPTY,this.inputChanges=new l.Subject,this._hasErrors=!1,this.currentTextWidth=0,this.size="regular"}return e.prototype.ngOnInit=function(){this.setupErrorPopover()},e.prototype.ngAfterContentInit=function(){var e=this;this._validateControlChild(),this.subscription=this._control.stateChanges.pipe(s.startWith(null)).subscribe(function(){e._hasErrors=e._control.errorState,e.updateErrorPopoverState(),e._changeDetectorRef.markForCheck()}),this._control.ngControl?this.subscriptionValues=this._control.ngControl.valueChanges.subscribe(function(t){e.updateCurrentTextWidth(),e.inputChanges.next()}):this.subscriptionValues=this._control.stateChanges.subscribe(function(t){e.updateCurrentTextWidth(),e.inputChanges.next()}),this._control.setAriaLabel(this.label)},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.updateCurrentTextWidth=function(){this.measureCanvas||(this.measureCanvas=this._renderer.createElement("canvas"));var e=this.measureCanvas.getContext("2d"),t=this._control.elementRef,n=window.getComputedStyle(t.nativeElement);e.font=o.getFontShorthand(n);var r=e.measureText(this._control.value).width+parseInt(n.paddingRight,10)+parseInt(n.paddingLeft,10)+1,i=this.elementRef.nativeElement.parentElement.getBoundingClientRect();this.currentTextWidth=Math.max(parseInt(n.minWidth,10),r),this.currentTextWidth=Math.min(this.currentTextWidth,i.width),this._overlayRef.hasAttached()&&this._overlayState.positionStrategy.apply()},e.prototype.repositionError=function(){this._overlayRef.hasAttached()&&this._overlayState.positionStrategy.apply()},e.prototype._validateControlChild=function(){if(!this._control)throw new Error("NxWordComponent requires an NxFormfieldControl compatible input.")},e.prototype.getConnectedOverlayOrigin=function(){return this.elementRef},Object.defineProperty(e.prototype,"isFocused",{get:function(){return this._control.focused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFilled",{get:function(){return!this._control.empty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasDropdown",{get:function(){return Boolean(this._dropdown)},enumerable:!0,configurable:!0}),e.prototype.updateErrorPopoverState=function(){this._hasErrors&&this._errorChildren.length>0?this.showPopover():this.hidePopover()},e.prototype.setupErrorPopover=function(){var e=this,t=this._overlayPositionBuilder.flexibleConnectedTo(this.elementRef).withLockedPosition(!0).withFlexibleDimensions(!1).withPush(!0).withPositions([{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom"},{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top"}]).withDefaultOffsetY(-8);this._overlayState=new i.OverlayConfig,this._overlayState.positionStrategy=t,this._overlayState.scrollStrategy=this._overlay.scrollStrategies.reposition(),this._overlayRef=this._overlay.create(this._overlayState),this._overlayState.positionStrategy.positionChanges.subscribe(function(t){var n=t.connectionPair;e.positionArrow(n),e._embeddedViewRef&&!e._embeddedViewRef.destroyed&&e._embeddedViewRef.detectChanges()})},e.prototype.positionArrow=function(e){var t=this.elementRef.nativeElement.getBoundingClientRect().left+this.elementRef.nativeElement.getBoundingClientRect().width/2-(this._overlayRef.overlayElement.parentElement.offsetLeft+this._overlayRef.overlayElement.offsetLeft);"top"===e.originY&&"bottom"===e.overlayY?this._popover.direction="top":this._popover.direction="bottom",this._popover.arrowStyle={left:t+"px"}},e.prototype.showPopover=function(){if(!this._overlayRef.hasAttached()){var e=new d.TemplatePortal(this._popover.templateRef,this._viewContainerRef);this._embeddedViewRef=this._overlayRef.attach(e)}},e.prototype.hidePopover=function(){this._overlayRef.detach()},e.decorators=[{type:a.Component,args:[{selector:"nx-word",template:'<div>\n  \x3c!-- We only allow formfield controls here --\x3e\n  <div *ngIf="!hasDropdown" class="nx-word__inner-wrapper">\n    <ng-content select="[nxInput]"></ng-content>\n  </div>\n  <ng-content select="nx-dropdown"></ng-content>\n</div>\n\n<nx-popover #popover>\n  <ng-content select="[nxError]"></ng-content>\n</nx-popover>',host:{"[class.size-short]":'size == "short"',"[class.size-regular]":'size == "regular"',"[class.size-long]":'size == "long"',"[class.has-error]":"_hasErrors","[class.is-focused]":"isFocused","[class.is-filled]":"isFilled","[class.has-dropdown]":"hasDropdown"},changeDetection:a.ChangeDetectionStrategy.OnPush,styles:[":host{display:inline-block;position:relative;font-weight:400;text-align:center;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;width:100%;margin:0 4px}:host .nx-word__inner-wrapper{border-bottom:2px solid #d9d9d9}:host.size-short{min-width:80px}:host.size-regular{min-width:152px}:host.size-long{min-width:360px}@media (max-width:991px){:host.size-long{min-width:280px}}@media (max-width:703px){:host.size-long{min-width:248px}}:host ::ng-deep .c-input{display:inline-block;text-align:inherit;font-size:inherit;line-height:inherit;background:0 0;color:inherit;border:none;outline:0;margin:0;width:100%;max-width:100%;height:auto;box-shadow:none;padding:0 8px}:host ::ng-deep .c-input.is-focused{outline:0;box-shadow:none}:host ::ng-deep .c-input.is-filled,:host ::ng-deep .c-input.is-focused{color:#006192;color:var(--natural-language-form-active-color,#006192);font-weight:400}:host ::ng-deep .c-input.is-disabled{cursor:not-allowed}:host ::ng-deep .c-input::-ms-clear{display:none}:host ::ng-deep nx-dropdown{position:relative;border-bottom:2px solid #d9d9d9}:host ::ng-deep nx-dropdown .nx-dropdown__container{font-size:inherit;margin-bottom:-2px}:host ::ng-deep nx-dropdown.has-focus,:host ::ng-deep nx-dropdown.is-filled{color:#006192;color:var(--natural-language-form-active-color,#006192);border-color:#007ab3;border-color:var(--natural-language-form-active-border-color,#007ab3)}:host ::ng-deep nx-dropdown .nx-dropdown__icon{line-height:inherit}:host ::ng-deep .nx-word__input-wrapper{width:100%}:host(.is-filled) .nx-word__inner-wrapper,:host(.is-focused) .nx-word__inner-wrapper{border-color:#007ab3;border-color:var(--natural-language-form-active-border-color,#007ab3)}:host(.has-error) .nx-word__inner-wrapper{border-color:#dc3149;border-color:var(--natural-language-form-error-border-color,#dc3149)}:host.has-error ::ng-deep nx-dropdown{color:#dc3149;color:var(--natural-language-form-error-color,#dc3149);border-color:#dc3149;border-color:var(--natural-language-form-error-border-color,#dc3149)}:host.has-error ::ng-deep .c-input.has-error{color:#dc3149;color:var(--natural-language-form-error-color,#dc3149)}:host-context(.is-negative) ::ng-deep .nx-dropdown,:host-context(.is-negative) ::ng-deep nx-dropdown,:host-context(.is-negative) ::ng-deep nx-dropdown.is-filled{border-color:#fff;color:#fff}:host-context(.is-negative) ::ng-deep .c-input,:host-context(.is-negative) ::ng-deep .c-input.has-error{color:#fff}:host-context(.is-negative) .nx-word__inner-wrapper{border-color:#fff}.nx-word__inner-wrapper{height:52px;height:var(--natural-language-form-large-line-height,52px)}@media (max-width:991px){:host ::ng-deep nx-dropdown .nx-dropdown__container{font-size:26px}.nx-word__inner-wrapper{height:36px;height:var(--natural-language-form-small-line-height,36px)}}:host-context(.nx-natural-language-form--small) .nx-word__inner-wrapper{height:36px;height:var(--natural-language-form-small-line-height,36px)}@media screen and (-ms-high-contrast:active){.nx-word__inner-wrapper,::ng-deep nx-dropdown{border-bottom-color:buttonText}}"]}]}],e.ctorParameters=function(){return[{type:a.ElementRef},{type:a.ChangeDetectorRef},{type:a.Renderer2},{type:i.Overlay},{type:a.ViewContainerRef},{type:i.OverlayPositionBuilder}]},e.propDecorators={_control:[{type:a.ContentChild,args:[r.NxFormfieldControl,{static:!1}]}],_errorChildren:[{type:a.ContentChildren,args:[r.NxFormfieldErrorDirective]}],_popover:[{type:a.ViewChild,args:["popover",{static:!0}]}],_dropdown:[{type:a.ContentChild,args:[p.NxDropdownComponent,{static:!1}]}],currentTextWidth:[{type:a.HostBinding,args:["style.width.px"]}],size:[{type:a.Input,args:["nxSize"]}],label:[{type:a.Input,args:["nxLabel"]}]},e}();var f="large",x=function(){function e(e){this._changeDetectorRef=e,this._negative=!1,this.resizeEvent$=new l.Subject,this.updatePopoversSubscription=l.Subscription.EMPTY,this._size=f}return Object.defineProperty(e.prototype,"negative",{get:function(){return this._negative},set:function(e){this._negative=h.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){this._size=e,this._changeDetectorRef.markForCheck()},enumerable:!0,configurable:!0}),e.prototype.onResize=function(e){this.resizeEvent$.next()},e.prototype.ngAfterContentInit=function(){var e=this,t=this._words.map(function(e){return e.inputChanges}),n=l.merge.apply(void 0,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}(t));this.updatePopoversSubscription=n.subscribe(function(){e.updatePositionPopovers()}),this.resizeObservable=this.resizeEvent$.pipe(s.throttleTime(500),s.delay(100)),this.resizeObservable.subscribe(function(){return e.resizeWords()})},e.prototype.resizeWords=function(){this._words.forEach(function(e){e.updateCurrentTextWidth()})},e.prototype.ngOnDestroy=function(){this.updatePopoversSubscription.unsubscribe()},e.prototype.updatePositionPopovers=function(){this._words&&this._words.forEach(function(e){e.repositionError()})},e.decorators=[{type:a.Component,args:[{selector:"nx-natural-language-form",template:'<div class="nx-natural-language-form__wrapper">\n    <ng-content></ng-content>\n</div>',changeDetection:a.ChangeDetectionStrategy.OnPush,host:{"[class.is-negative]":"negative","[class.nx-natural-language-form--small]":'size === "small"',"[class.nx-natural-language-form--large]":'size === "large"'},styles:[":host{display:block;font-size:40px;font-size:var(--natural-language-form-large-font-size,40px);line-height:52px;line-height:var(--natural-language-form-large-line-height,52px);font-weight:300;font-weight:var(--natural-language-form-large-font-weight,300);letter-spacing:.3px;letter-spacing:var(--natural-language-form-large-letter-spacing,.3px);color:#414141;color:var(--natural-language-form-text-color,#414141);padding-top:72px;padding-bottom:80px}:host ::ng-deep .c-input{font-size:inherit;line-height:inherit}:host ::ng-deep nx-word+nx-word{margin-left:2px}:host.is-negative{color:#fff}@media (max-width:991px){:host{font-size:26px;font-size:var(--natural-language-form-small-font-size,26px);line-height:36px;line-height:var(--natural-language-form-small-line-height,36px);font-weight:300;font-weight:var(--natural-language-form-small-font-weight,300);letter-spacing:.3px;letter-spacing:var(--natural-language-form-small-letter-spacing,.3px)}}.nx-natural-language-form__wrapper{display:flex;flex-wrap:wrap}.nx-natural-language-form__wrapper>::ng-deep *{margin-bottom:8px}:host(.nx-natural-language-form--small){font-size:26px;font-size:var(--natural-language-form-small-font-size,26px);line-height:36px;line-height:var(--natural-language-form-small-line-height,36px);font-weight:300;font-weight:var(--natural-language-form-small-font-weight,300);letter-spacing:.3px;letter-spacing:var(--natural-language-form-small-letter-spacing,.3px)}:host(.nx-natural-language-form--small) ::ng-deep .c-input{font-size:inherit;line-height:inherit}"]}]}],e.ctorParameters=function(){return[{type:a.ChangeDetectorRef}]},e.propDecorators={_words:[{type:a.ContentChildren,args:[u]}],negative:[{type:a.Input,args:["nxNegative"]}],size:[{type:a.Input}],onResize:[{type:a.HostListener,args:["window:orientationchange",["$event"]]},{type:a.HostListener,args:["window:resize",["$event"]]}]},e}();var m=function(){function e(){}return e.decorators=[{type:a.NgModule,args:[{imports:[g.CommonModule,n.NxInputModule,t.NxPopoverModule],declarations:[x,u],exports:[x,u]}]}],e}();e.NxNaturalLanguageFormComponent=x,e.NxNaturalLanguageFormModule=m,e.NxWordComponent=u,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=allianz-ngx-ndbx-natural-language-form.umd.min.js.map