/**
 * @fileoverview added by tsickle
 * Generated from: message/message-toast/message-toast.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, Injector, InjectionToken, Inject, Optional, SkipSelf } from '@angular/core';
import { Overlay, OverlayConfig } from '@angular/cdk/overlay';
import { ComponentPortal, PortalInjector, TemplatePortal } from '@angular/cdk/portal';
import { NxMessageToastComponent } from './message-toast.component';
import { NxMessageToastConfig, NxMessageToastData } from './message-toast-config';
import { NxMessageToastRef } from './message-toast-ref';
import { LiveAnnouncer } from '@angular/cdk/a11y';
import { NxMessageModule } from '../message.module';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/overlay";
import * as i2 from "@angular/cdk/a11y";
import * as i3 from "../message.module";
/**
 * Injection token that can be used to specify default message toast.
 * @type {?}
 */
export var NX_MESSAGE_TOAST_DEFAULT_CONFIG = new InjectionToken('NX_MESSAGE_TOAST_DEFAULT_CONFIG');
/**
 * A service for dispatching and displaying toast messages.
 */
var NxMessageToastService = /** @class */ (function () {
    function NxMessageToastService(_overlay, _injector, _live, _parentMessageToastService, _defaultConfig) {
        this._overlay = _overlay;
        this._injector = _injector;
        this._live = _live;
        this._parentMessageToastService = _parentMessageToastService;
        this._defaultConfig = _defaultConfig;
        /**
         * Reference to the current message toast in the view *at this level* (in the Angular injector tree).
         * If there is a parent message toast service, all operations should delegate to that parent
         * via `_oldToastMessageRef`.
         */
        this._toastRefAtThisLevel = null;
    }
    Object.defineProperty(NxMessageToastService.prototype, "_oldToastMessageRef", {
        /** Reference to the currently opened message toastat *any* level. */
        get: /**
         * Reference to the currently opened message toastat *any* level.
         * @return {?}
         */
        function () {
            /** @type {?} */
            var parent = this._parentMessageToastService;
            return parent ? parent._oldToastMessageRef : this._toastRefAtThisLevel;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (this._parentMessageToastService) {
                this._parentMessageToastService._oldToastMessageRef = value;
            }
            else {
                this._toastRefAtThisLevel = value;
            }
        },
        enumerable: true,
        configurable: true
    });
    /** Creates and dispatches a message toastwith a custom text.
     *
     * @param text Text to be used for the message toast.
     * @param config Extra configuration for the message toast.
    */
    /**
     * Creates and dispatches a message toastwith a custom text.
     *
     * @param {?} text Text to be used for the message toast.
     * @param {?=} config Extra configuration for the message toast.
     * @return {?}
     */
    NxMessageToastService.prototype.open = /**
     * Creates and dispatches a message toastwith a custom text.
     *
     * @param {?} text Text to be used for the message toast.
     * @param {?=} config Extra configuration for the message toast.
     * @return {?}
     */
    function (text, config) {
        /** @type {?} */
        var currentConfig = tslib_1.__assign({}, new NxMessageToastConfig(), this._defaultConfig, config);
        /** @type {?} */
        var overlayRef = this._createOverlay(currentConfig);
        /** @type {?} */
        var injector = this._createInjector(currentConfig, new NxMessageToastData(text), this._injector);
        /** @type {?} */
        var componentPortal = new ComponentPortal(NxMessageToastComponent, undefined, injector);
        /** @type {?} */
        var componentRef = overlayRef.attach(componentPortal);
        /** @type {?} */
        var toastRef = new NxMessageToastRef(componentRef.instance, overlayRef);
        this._animateToast(toastRef, currentConfig);
        this._oldToastMessageRef = toastRef;
        return this._oldToastMessageRef;
    };
    /** Creates and dispatches a message toastwith a custom template for the content.
     *
     * @param template Template to be used for the message toast.
     * @param config Extra configuration for the message toast.
    */
    /**
     * Creates and dispatches a message toastwith a custom template for the content.
     *
     * @param {?} template Template to be used for the message toast.
     * @param {?=} config Extra configuration for the message toast.
     * @return {?}
     */
    NxMessageToastService.prototype.openFromTemplate = /**
     * Creates and dispatches a message toastwith a custom template for the content.
     *
     * @param {?} template Template to be used for the message toast.
     * @param {?=} config Extra configuration for the message toast.
     * @return {?}
     */
    function (template, config) {
        /** @type {?} */
        var currentConfig = tslib_1.__assign({}, new NxMessageToastConfig(), this._defaultConfig, config);
        /** @type {?} */
        var overlayRef = this._createOverlay(currentConfig);
        /** @type {?} */
        var container = this._attachToastComponent(overlayRef, currentConfig);
        /** @type {?} */
        var toastRef = new NxMessageToastRef(container, overlayRef);
        /** @type {?} */
        var portal = new TemplatePortal(template, (/** @type {?} */ (null)), toastRef);
        container.attachTemplatePortal(portal);
        this._animateToast(toastRef, currentConfig);
        this._oldToastMessageRef = toastRef;
        return this._oldToastMessageRef;
    };
    // Attaches the message toastcontainer component to the overlay.
    // Attaches the message toastcontainer component to the overlay.
    /**
     * @private
     * @param {?} overlayRef
     * @param {?} config
     * @return {?}
     */
    NxMessageToastService.prototype._attachToastComponent = 
    // Attaches the message toastcontainer component to the overlay.
    /**
     * @private
     * @param {?} overlayRef
     * @param {?} config
     * @return {?}
     */
    function (overlayRef, config) {
        /** @type {?} */
        var injector = this._createInjector(config, null, this._injector);
        /** @type {?} */
        var containerPortal = new ComponentPortal(NxMessageToastComponent, null, injector);
        /** @type {?} */
        var containerRef = overlayRef.attach(containerPortal);
        containerRef.instance.config = config;
        return containerRef.instance;
    };
    // Creates a new overlay and places it in the correct place.
    // Creates a new overlay and places it in the correct place.
    /**
     * @private
     * @param {?} config
     * @return {?}
     */
    NxMessageToastService.prototype._createOverlay = 
    // Creates a new overlay and places it in the correct place.
    /**
     * @private
     * @param {?} config
     * @return {?}
     */
    function (config) {
        /** @type {?} */
        var overlayConfig = new OverlayConfig();
        /** @type {?} */
        var positionStrategy = this._overlay.position().global();
        positionStrategy.bottom('0');
        positionStrategy.centerHorizontally();
        overlayConfig.positionStrategy = positionStrategy;
        return this._overlay.create(overlayConfig);
    };
    /** Animates the old message toastout and the new one in. */
    /**
     * Animates the old message toastout and the new one in.
     * @private
     * @param {?} toastRef
     * @param {?} config
     * @return {?}
     */
    NxMessageToastService.prototype._animateToast = /**
     * Animates the old message toastout and the new one in.
     * @private
     * @param {?} toastRef
     * @param {?} config
     * @return {?}
     */
    function (toastRef, config) {
        var _this = this;
        // When the message toastis dismissed, clear the reference to it.
        toastRef.afterDismissed().subscribe((/**
         * @return {?}
         */
        function () {
            // Clear the message toastref if it hasn't already been replaced by a newer message toast.
            if (_this._oldToastMessageRef === toastRef) {
                _this._oldToastMessageRef = null;
            }
            if (config.announcementMessage) {
                _this._live.clear();
            }
        }));
        if (this._oldToastMessageRef) {
            // If a message toastis opened, dismiss it and enter the
            // new message toastafter exit animation is complete.
            this._oldToastMessageRef.afterDismissed().subscribe((/**
             * @return {?}
             */
            function () {
                toastRef.toastInstance.enter();
            }));
            this._oldToastMessageRef.dismiss();
        }
        else {
            // If no message toastis in view, enter the message toast.
            toastRef.toastInstance.enter();
        }
        // If a message toastduration is provided, set up dismiss based on after the message toastis opened.
        if (config.duration && config.duration > 0) {
            toastRef.afterOpened().subscribe((/**
             * @return {?}
             */
            function () { return toastRef._dismissAfter((/** @type {?} */ (config.duration))); }));
        }
        if (config.announcementMessage) {
            this._live.announce(config.announcementMessage, config.politeness);
        }
    };
    /**
     * @private
     * @param {?} config
     * @param {?} data
     * @param {?} injector
     * @return {?}
     */
    NxMessageToastService.prototype._createInjector = /**
     * @private
     * @param {?} config
     * @param {?} data
     * @param {?} injector
     * @return {?}
     */
    function (config, data, injector) {
        /** @type {?} */
        var tokens = new WeakMap();
        tokens.set(NxMessageToastConfig, config);
        tokens.set(NxMessageToastData, data);
        return new PortalInjector(injector, tokens);
    };
    /**
     * Dismisses the currently visible message toast.
     */
    /**
     * Dismisses the currently visible message toast.
     * @return {?}
     */
    NxMessageToastService.prototype.dismiss = /**
     * Dismisses the currently visible message toast.
     * @return {?}
     */
    function () {
        if (this._oldToastMessageRef) {
            this._oldToastMessageRef.dismiss();
        }
    };
    /**
     * @return {?}
     */
    NxMessageToastService.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this._toastRefAtThisLevel) {
            this._toastRefAtThisLevel.dismiss();
        }
    };
    NxMessageToastService.decorators = [
        { type: Injectable, args: [{ providedIn: NxMessageModule },] }
    ];
    /** @nocollapse */
    NxMessageToastService.ctorParameters = function () { return [
        { type: Overlay },
        { type: Injector },
        { type: LiveAnnouncer },
        { type: NxMessageToastService, decorators: [{ type: Optional }, { type: SkipSelf }] },
        { type: NxMessageToastConfig, decorators: [{ type: Optional }, { type: Inject, args: [NX_MESSAGE_TOAST_DEFAULT_CONFIG,] }] }
    ]; };
    /** @nocollapse */ NxMessageToastService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function NxMessageToastService_Factory() { return new NxMessageToastService(i0.ɵɵinject(i1.Overlay), i0.ɵɵinject(i0.INJECTOR), i0.ɵɵinject(i2.LiveAnnouncer), i0.ɵɵinject(NxMessageToastService, 12), i0.ɵɵinject(NX_MESSAGE_TOAST_DEFAULT_CONFIG, 8)); }, token: NxMessageToastService, providedIn: i3.NxMessageModule });
    return NxMessageToastService;
}());
export { NxMessageToastService };
if (false) {
    /**
     * Reference to the current message toast in the view *at this level* (in the Angular injector tree).
     * If there is a parent message toast service, all operations should delegate to that parent
     * via `_oldToastMessageRef`.
     * @type {?}
     * @private
     */
    NxMessageToastService.prototype._toastRefAtThisLevel;
    /**
     * @type {?}
     * @private
     */
    NxMessageToastService.prototype._overlay;
    /**
     * @type {?}
     * @private
     */
    NxMessageToastService.prototype._injector;
    /**
     * @type {?}
     * @private
     */
    NxMessageToastService.prototype._live;
    /**
     * @type {?}
     * @private
     */
    NxMessageToastService.prototype._parentMessageToastService;
    /**
     * @type {?}
     * @private
     */
    NxMessageToastService.prototype._defaultConfig;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZS10b2FzdC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGFsbGlhbnovbmd4LW5kYngvIiwic291cmNlcyI6WyJtZXNzYWdlL21lc3NhZ2UtdG9hc3QvbWVzc2FnZS10b2FzdC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUE2QixjQUFjLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFDdkksT0FBTyxFQUFFLE9BQU8sRUFBYyxhQUFhLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMxRSxPQUFPLEVBQUUsZUFBZSxFQUFFLGNBQWMsRUFBRSxjQUFjLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RixPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNwRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNsRixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDOzs7Ozs7Ozs7QUFHcEQsTUFBTSxLQUFPLCtCQUErQixHQUMxQyxJQUFJLGNBQWMsQ0FBdUIsaUNBQWlDLENBQUM7Ozs7QUFHN0U7SUF3QkUsK0JBQ1UsUUFBaUIsRUFDakIsU0FBbUIsRUFDbkIsS0FBb0IsRUFDSSwwQkFBaUQsRUFDcEIsY0FBb0M7UUFKekYsYUFBUSxHQUFSLFFBQVEsQ0FBUztRQUNqQixjQUFTLEdBQVQsU0FBUyxDQUFVO1FBQ25CLFVBQUssR0FBTCxLQUFLLENBQWU7UUFDSSwrQkFBMEIsR0FBMUIsMEJBQTBCLENBQXVCO1FBQ3BCLG1CQUFjLEdBQWQsY0FBYyxDQUFzQjs7Ozs7O1FB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QixFQUFFO1lBQzdCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLEVBQUUsQ0FBQztTQUNyQztJQUNILENBQUM7O2dCQXBKRixVQUFVLFNBQUMsRUFBRSxVQUFVLEVBQUUsZUFBZSxFQUFFOzs7O2dCQWJsQyxPQUFPO2dCQURLLFFBQVE7Z0JBTXBCLGFBQWE7Z0JBb0MwQyxxQkFBcUIsdUJBQWhGLFFBQVEsWUFBSSxRQUFRO2dCQXRDaEIsb0JBQW9CLHVCQXVDeEIsUUFBUSxZQUFJLE1BQU0sU0FBQywrQkFBK0I7OztnQ0EzQ3ZEO0NBbUtDLEFBckpELElBcUpDO1NBcEpZLHFCQUFxQjs7Ozs7Ozs7O0lBT2hDLHFEQUE4RDs7Ozs7SUFpQjVELHlDQUF5Qjs7Ozs7SUFDekIsMENBQTJCOzs7OztJQUMzQixzQ0FBNEI7Ozs7O0lBQzVCLDJEQUFpRjs7Ozs7SUFDakYsK0NBQWlHIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0b3IsIENvbXBvbmVudFJlZiwgVGVtcGxhdGVSZWYsIEluamVjdGlvblRva2VuLCBJbmplY3QsIE9wdGlvbmFsLCBTa2lwU2VsZiwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPdmVybGF5LCBPdmVybGF5UmVmLCBPdmVybGF5Q29uZmlnIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL292ZXJsYXknO1xuaW1wb3J0IHsgQ29tcG9uZW50UG9ydGFsLCBQb3J0YWxJbmplY3RvciwgVGVtcGxhdGVQb3J0YWwgfSBmcm9tICdAYW5ndWxhci9jZGsvcG9ydGFsJztcbmltcG9ydCB7IE54TWVzc2FnZVRvYXN0Q29tcG9uZW50IH0gZnJvbSAnLi9tZXNzYWdlLXRvYXN0LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBOeE1lc3NhZ2VUb2FzdENvbmZpZywgTnhNZXNzYWdlVG9hc3REYXRhIH0gZnJvbSAnLi9tZXNzYWdlLXRvYXN0LWNvbmZpZyc7XG5pbXBvcnQgeyBOeE1lc3NhZ2VUb2FzdFJlZiB9IGZyb20gJy4vbWVzc2FnZS10b2FzdC1yZWYnO1xuaW1wb3J0IHsgTGl2ZUFubm91bmNlciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9hMTF5JztcbmltcG9ydCB7IE54TWVzc2FnZU1vZHVsZSB9IGZyb20gJy4uL21lc3NhZ2UubW9kdWxlJztcblxuLyoqIEluamVjdGlvbiB0b2tlbiB0aGF0IGNhbiBiZSB1c2VkIHRvIHNwZWNpZnkgZGVmYXVsdCBtZXNzYWdlIHRvYXN0LiAqL1xuZXhwb3J0IGNvbnN0IE5YX01FU1NBR0VfVE9BU1RfREVGQVVMVF9DT05GSUcgPVxuICBuZXcgSW5qZWN0aW9uVG9rZW48TnhNZXNzYWdlVG9hc3RDb25maWc+KCdOWF9NRVNTQUdFX1RPQVNUX0RFRkFVTFRfQ09ORklHJyk7XG5cbi8qKiBBIHNlcnZpY2UgZm9yIGRpc3BhdGNoaW5nIGFuZCBkaXNwbGF5aW5nIHRvYXN0IG1lc3NhZ2VzLiAqL1xuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiBOeE1lc3NhZ2VNb2R1bGUgfSlcbmV4cG9ydCBjbGFzcyBOeE1lc3NhZ2VUb2FzdFNlcnZpY2UgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuXG4vKipcbiAqIFJlZmVyZW5jZSB0byB0aGUgY3VycmVudCBtZXNzYWdlIHRvYXN0IGluIHRoZSB2aWV3ICphdCB0aGlzIGxldmVsKiAoaW4gdGhlIEFuZ3VsYXIgaW5qZWN0b3IgdHJlZSkuXG4gKiBJZiB0aGVyZSBpcyBhIHBhcmVudCBtZXNzYWdlIHRvYXN0IHNlcnZpY2UsIGFsbCBvcGVyYXRpb25zIHNob3VsZCBkZWxlZ2F0ZSB0byB0aGF0IHBhcmVudFxuICogdmlhIGBfb2xkVG9hc3RNZXNzYWdlUmVmYC5cbiAqL1xuICBwcml2YXRlIF90b2FzdFJlZkF0VGhpc0xldmVsOiBOeE1lc3NhZ2VUb2FzdFJlZiB8IG51bGwgPSBudWxsO1xuXG4gIC8qKiBSZWZlcmVuY2UgdG8gdGhlIGN1cnJlbnRseSBvcGVuZWQgbWVzc2FnZSB0b2FzdGF0ICphbnkqIGxldmVsLiAqL1xuICBnZXQgX29sZFRvYXN0TWVzc2FnZVJlZigpOiBOeE1lc3NhZ2VUb2FzdFJlZiB8IG51bGwge1xuICAgIGNvbnN0IHBhcmVudCA9IHRoaXMuX3BhcmVudE1lc3NhZ2VUb2FzdFNlcnZpY2U7XG4gICAgcmV0dXJuIHBhcmVudCA/IHBhcmVudC5fb2xkVG9hc3RNZXNzYWdlUmVmIDogdGhpcy5fdG9hc3RSZWZBdFRoaXNMZXZlbDtcbiAgfVxuXG4gIHNldCBfb2xkVG9hc3RNZXNzYWdlUmVmKHZhbHVlOiBOeE1lc3NhZ2VUb2FzdFJlZiB8IG51bGwpIHtcbiAgICBpZiAodGhpcy5fcGFyZW50TWVzc2FnZVRvYXN0U2VydmljZSkge1xuICAgICAgdGhpcy5fcGFyZW50TWVzc2FnZVRvYXN0U2VydmljZS5fb2xkVG9hc3RNZXNzYWdlUmVmID0gdmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3RvYXN0UmVmQXRUaGlzTGV2ZWwgPSB2YWx1ZTtcbiAgICB9XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIF9vdmVybGF5OiBPdmVybGF5LFxuICAgIHByaXZhdGUgX2luamVjdG9yOiBJbmplY3RvcixcbiAgICBwcml2YXRlIF9saXZlOiBMaXZlQW5ub3VuY2VyLFxuICAgIEBPcHRpb25hbCgpIEBTa2lwU2VsZigpIHByaXZhdGUgX3BhcmVudE1lc3NhZ2VUb2FzdFNlcnZpY2U6IE54TWVzc2FnZVRvYXN0U2VydmljZSxcbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KE5YX01FU1NBR0VfVE9BU1RfREVGQVVMVF9DT05GSUcpIHByaXZhdGUgX2RlZmF1bHRDb25maWc6IE54TWVzc2FnZVRvYXN0Q29uZmlnKSB7IH1cblxuICAvKiogQ3JlYXRlcyBhbmQgZGlzcGF0Y2hlcyBhIG1lc3NhZ2UgdG9hc3R3aXRoIGEgY3VzdG9tIHRleHQuXG4gICAqXG4gICAqIEBwYXJhbSB0ZXh0IFRleHQgdG8gYmUgdXNlZCBmb3IgdGhlIG1lc3NhZ2UgdG9hc3QuXG4gICAqIEBwYXJhbSBjb25maWcgRXh0cmEgY29uZmlndXJhdGlvbiBmb3IgdGhlIG1lc3NhZ2UgdG9hc3QuXG4gICovXG4gIG9wZW4odGV4dDogc3RyaW5nLCBjb25maWc/OiBOeE1lc3NhZ2VUb2FzdENvbmZpZyk6IE54TWVzc2FnZVRvYXN0UmVmIHtcbiAgICBjb25zdCBjdXJyZW50Q29uZmlnID0geyAuLi5uZXcgTnhNZXNzYWdlVG9hc3RDb25maWcoKSwgLi4udGhpcy5fZGVmYXVsdENvbmZpZywgLi4uY29uZmlnIH07XG4gICAgY29uc3Qgb3ZlcmxheVJlZiA9IHRoaXMuX2NyZWF0ZU92ZXJsYXkoY3VycmVudENvbmZpZyk7XG4gICAgY29uc3QgaW5qZWN0b3IgPSB0aGlzLl9jcmVhdGVJbmplY3RvcihjdXJyZW50Q29uZmlnLCBuZXcgTnhNZXNzYWdlVG9hc3REYXRhKHRleHQpLCB0aGlzLl9pbmplY3Rvcik7XG5cbiAgICBjb25zdCBjb21wb25lbnRQb3J0YWwgPSBuZXcgQ29tcG9uZW50UG9ydGFsKE54TWVzc2FnZVRvYXN0Q29tcG9uZW50LCB1bmRlZmluZWQsIGluamVjdG9yKTtcbiAgICBjb25zdCBjb21wb25lbnRSZWYgPSBvdmVybGF5UmVmLmF0dGFjaChjb21wb25lbnRQb3J0YWwpO1xuICAgIGNvbnN0IHRvYXN0UmVmID0gbmV3IE54TWVzc2FnZVRvYXN0UmVmKGNvbXBvbmVudFJlZi5pbnN0YW5jZSwgb3ZlcmxheVJlZik7XG5cbiAgICB0aGlzLl9hbmltYXRlVG9hc3QodG9hc3RSZWYsIGN1cnJlbnRDb25maWcpO1xuICAgIHRoaXMuX29sZFRvYXN0TWVzc2FnZVJlZiA9IHRvYXN0UmVmO1xuICAgIHJldHVybiB0aGlzLl9vbGRUb2FzdE1lc3NhZ2VSZWY7XG4gIH1cblxuICAvKiogQ3JlYXRlcyBhbmQgZGlzcGF0Y2hlcyBhIG1lc3NhZ2UgdG9hc3R3aXRoIGEgY3VzdG9tIHRlbXBsYXRlIGZvciB0aGUgY29udGVudC5cbiAgICpcbiAgICogQHBhcmFtIHRlbXBsYXRlIFRlbXBsYXRlIHRvIGJlIHVzZWQgZm9yIHRoZSBtZXNzYWdlIHRvYXN0LlxuICAgKiBAcGFyYW0gY29uZmlnIEV4dHJhIGNvbmZpZ3VyYXRpb24gZm9yIHRoZSBtZXNzYWdlIHRvYXN0LlxuICAqL1xuICBvcGVuRnJvbVRlbXBsYXRlKHRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+LCBjb25maWc/OiBOeE1lc3NhZ2VUb2FzdENvbmZpZyk6IE54TWVzc2FnZVRvYXN0UmVmIHtcbiAgICBjb25zdCBjdXJyZW50Q29uZmlnID0geyAuLi5uZXcgTnhNZXNzYWdlVG9hc3RDb25maWcoKSwgLi4udGhpcy5fZGVmYXVsdENvbmZpZywgLi4uY29uZmlnIH07XG4gICAgY29uc3Qgb3ZlcmxheVJlZiA9IHRoaXMuX2NyZWF0ZU92ZXJsYXkoY3VycmVudENvbmZpZyk7XG4gICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5fYXR0YWNoVG9hc3RDb21wb25lbnQob3ZlcmxheVJlZiwgY3VycmVudENvbmZpZyk7XG4gICAgY29uc3QgdG9hc3RSZWYgPSBuZXcgTnhNZXNzYWdlVG9hc3RSZWYoY29udGFpbmVyLCBvdmVybGF5UmVmKTtcbiAgICBjb25zdCBwb3J0YWwgPSBuZXcgVGVtcGxhdGVQb3J0YWwodGVtcGxhdGUsIG51bGwhLCB0b2FzdFJlZik7XG5cbiAgICBjb250YWluZXIuYXR0YWNoVGVtcGxhdGVQb3J0YWwocG9ydGFsKTtcbiAgICB0aGlzLl9hbmltYXRlVG9hc3QodG9hc3RSZWYsIGN1cnJlbnRDb25maWcpO1xuICAgIHRoaXMuX29sZFRvYXN0TWVzc2FnZVJlZiA9IHRvYXN0UmVmO1xuICAgIHJldHVybiB0aGlzLl9vbGRUb2FzdE1lc3NhZ2VSZWY7XG4gIH1cblxuICAvLyBBdHRhY2hlcyB0aGUgbWVzc2FnZSB0b2FzdGNvbnRhaW5lciBjb21wb25lbnQgdG8gdGhlIG92ZXJsYXkuXG4gIHByaXZhdGUgX2F0dGFjaFRvYXN0Q29tcG9uZW50KG92ZXJsYXlSZWY6IE92ZXJsYXlSZWYsIGNvbmZpZzogTnhNZXNzYWdlVG9hc3RDb25maWcpOiBOeE1lc3NhZ2VUb2FzdENvbXBvbmVudCB7XG4gICAgY29uc3QgaW5qZWN0b3IgPSB0aGlzLl9jcmVhdGVJbmplY3Rvcihjb25maWcsIG51bGwsIHRoaXMuX2luamVjdG9yKTtcbiAgICBjb25zdCBjb250YWluZXJQb3J0YWwgPSBuZXcgQ29tcG9uZW50UG9ydGFsKE54TWVzc2FnZVRvYXN0Q29tcG9uZW50LCBudWxsLCBpbmplY3Rvcik7XG4gICAgY29uc3QgY29udGFpbmVyUmVmOiBDb21wb25lbnRSZWY8TnhNZXNzYWdlVG9hc3RDb21wb25lbnQ+ID0gb3ZlcmxheVJlZi5hdHRhY2goY29udGFpbmVyUG9ydGFsKTtcbiAgICBjb250YWluZXJSZWYuaW5zdGFuY2UuY29uZmlnID0gY29uZmlnO1xuXG4gICAgcmV0dXJuIGNvbnRhaW5lclJlZi5pbnN0YW5jZTtcbiAgfVxuXG4gIC8vIENyZWF0ZXMgYSBuZXcgb3ZlcmxheSBhbmQgcGxhY2VzIGl0IGluIHRoZSBjb3JyZWN0IHBsYWNlLlxuICBwcml2YXRlIF9jcmVhdGVPdmVybGF5KGNvbmZpZzogTnhNZXNzYWdlVG9hc3RDb25maWcpOiBPdmVybGF5UmVmIHtcbiAgICBjb25zdCBvdmVybGF5Q29uZmlnID0gbmV3IE92ZXJsYXlDb25maWcoKTtcbiAgICBjb25zdCBwb3NpdGlvblN0cmF0ZWd5ID0gdGhpcy5fb3ZlcmxheS5wb3NpdGlvbigpLmdsb2JhbCgpO1xuXG4gICAgcG9zaXRpb25TdHJhdGVneS5ib3R0b20oJzAnKTtcbiAgICBwb3NpdGlvblN0cmF0ZWd5LmNlbnRlckhvcml6b250YWxseSgpO1xuICAgIG92ZXJsYXlDb25maWcucG9zaXRpb25TdHJhdGVneSA9IHBvc2l0aW9uU3RyYXRlZ3k7XG5cbiAgICByZXR1cm4gdGhpcy5fb3ZlcmxheS5jcmVhdGUob3ZlcmxheUNvbmZpZyk7XG4gIH1cblxuICAvKiogQW5pbWF0ZXMgdGhlIG9sZCBtZXNzYWdlIHRvYXN0b3V0IGFuZCB0aGUgbmV3IG9uZSBpbi4gKi9cbiAgcHJpdmF0ZSBfYW5pbWF0ZVRvYXN0KHRvYXN0UmVmOiBOeE1lc3NhZ2VUb2FzdFJlZiwgY29uZmlnOiBOeE1lc3NhZ2VUb2FzdENvbmZpZykge1xuICAgIC8vIFdoZW4gdGhlIG1lc3NhZ2UgdG9hc3RpcyBkaXNtaXNzZWQsIGNsZWFyIHRoZSByZWZlcmVuY2UgdG8gaXQuXG4gICAgdG9hc3RSZWYuYWZ0ZXJEaXNtaXNzZWQoKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgLy8gQ2xlYXIgdGhlIG1lc3NhZ2UgdG9hc3RyZWYgaWYgaXQgaGFzbid0IGFscmVhZHkgYmVlbiByZXBsYWNlZCBieSBhIG5ld2VyIG1lc3NhZ2UgdG9hc3QuXG4gICAgICBpZiAodGhpcy5fb2xkVG9hc3RNZXNzYWdlUmVmID09PSB0b2FzdFJlZikge1xuICAgICAgICB0aGlzLl9vbGRUb2FzdE1lc3NhZ2VSZWYgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICBpZiAoY29uZmlnLmFubm91bmNlbWVudE1lc3NhZ2UpIHtcbiAgICAgICAgdGhpcy5fbGl2ZS5jbGVhcigpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKHRoaXMuX29sZFRvYXN0TWVzc2FnZVJlZikge1xuICAgICAgLy8gSWYgYSBtZXNzYWdlIHRvYXN0aXMgb3BlbmVkLCBkaXNtaXNzIGl0IGFuZCBlbnRlciB0aGVcbiAgICAgIC8vIG5ldyBtZXNzYWdlIHRvYXN0YWZ0ZXIgZXhpdCBhbmltYXRpb24gaXMgY29tcGxldGUuXG4gICAgICB0aGlzLl9vbGRUb2FzdE1lc3NhZ2VSZWYuYWZ0ZXJEaXNtaXNzZWQoKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0b2FzdFJlZi50b2FzdEluc3RhbmNlLmVudGVyKCk7XG4gICAgfSk7XG4gICAgICB0aGlzLl9vbGRUb2FzdE1lc3NhZ2VSZWYuZGlzbWlzcygpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIElmIG5vIG1lc3NhZ2UgdG9hc3RpcyBpbiB2aWV3LCBlbnRlciB0aGUgbWVzc2FnZSB0b2FzdC5cbiAgICAgIHRvYXN0UmVmLnRvYXN0SW5zdGFuY2UuZW50ZXIoKTtcbiAgICB9XG5cbiAgICAvLyBJZiBhIG1lc3NhZ2UgdG9hc3RkdXJhdGlvbiBpcyBwcm92aWRlZCwgc2V0IHVwIGRpc21pc3MgYmFzZWQgb24gYWZ0ZXIgdGhlIG1lc3NhZ2UgdG9hc3RpcyBvcGVuZWQuXG4gICAgaWYgKGNvbmZpZy5kdXJhdGlvbiAmJiBjb25maWcuZHVyYXRpb24gPiAwKSB7XG4gICAgICB0b2FzdFJlZi5hZnRlck9wZW5lZCgpLnN1YnNjcmliZSgoKSA9PiB0b2FzdFJlZi5fZGlzbWlzc0FmdGVyKGNvbmZpZy5kdXJhdGlvbiEpKTtcbiAgICB9XG5cbiAgICBpZiAoY29uZmlnLmFubm91bmNlbWVudE1lc3NhZ2UpIHtcbiAgICAgIHRoaXMuX2xpdmUuYW5ub3VuY2UoY29uZmlnLmFubm91bmNlbWVudE1lc3NhZ2UsIGNvbmZpZy5wb2xpdGVuZXNzKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9jcmVhdGVJbmplY3Rvcihjb25maWc6IE54TWVzc2FnZVRvYXN0Q29uZmlnLCBkYXRhOiBOeE1lc3NhZ2VUb2FzdERhdGEsIGluamVjdG9yOiBJbmplY3Rvcik6IFBvcnRhbEluamVjdG9yIHtcbiAgICBjb25zdCB0b2tlbnMgPSBuZXcgV2Vha01hcCgpO1xuICAgIHRva2Vucy5zZXQoTnhNZXNzYWdlVG9hc3RDb25maWcsIGNvbmZpZyk7XG4gICAgdG9rZW5zLnNldChOeE1lc3NhZ2VUb2FzdERhdGEsIGRhdGEpO1xuXG4gICAgcmV0dXJuIG5ldyBQb3J0YWxJbmplY3RvcihpbmplY3RvciwgdG9rZW5zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNtaXNzZXMgdGhlIGN1cnJlbnRseSB2aXNpYmxlIG1lc3NhZ2UgdG9hc3QuXG4gICAqL1xuICBkaXNtaXNzKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLl9vbGRUb2FzdE1lc3NhZ2VSZWYpIHtcbiAgICAgIHRoaXMuX29sZFRvYXN0TWVzc2FnZVJlZi5kaXNtaXNzKCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuX3RvYXN0UmVmQXRUaGlzTGV2ZWwpIHtcbiAgICAgIHRoaXMuX3RvYXN0UmVmQXRUaGlzTGV2ZWwuZGlzbWlzcygpO1xuICAgIH1cbiAgfVxufVxuIl19