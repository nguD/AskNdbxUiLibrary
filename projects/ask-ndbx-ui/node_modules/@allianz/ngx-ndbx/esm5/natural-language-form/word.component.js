/**
 * @fileoverview added by tsickle
 * Generated from: natural-language-form/word.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { NxFormfieldControl, NxFormfieldErrorDirective } from '@allianz/ngx-ndbx/formfield';
import { getFontShorthand } from '@allianz/ngx-ndbx/utils';
import { Overlay, OverlayConfig, OverlayPositionBuilder } from '@angular/cdk/overlay';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, ContentChildren, ElementRef, HostBinding, Input, QueryList, Renderer2, ViewChild, ViewContainerRef } from '@angular/core';
import { startWith } from 'rxjs/operators';
import { Subject, Subscription } from 'rxjs';
import { NxPopoverComponent } from '@allianz/ngx-ndbx/popover';
import { NxDropdownComponent } from '@allianz/ngx-ndbx/dropdown';
import { TemplatePortal } from '@angular/cdk/portal';
var NxWordComponent = /** @class */ (function () {
    function NxWordComponent(elementRef, _changeDetectorRef, _renderer, _overlay, _viewContainerRef, _overlayPositionBuilder) {
        this.elementRef = elementRef;
        this._changeDetectorRef = _changeDetectorRef;
        this._renderer = _renderer;
        this._overlay = _overlay;
        this._viewContainerRef = _viewContainerRef;
        this._overlayPositionBuilder = _overlayPositionBuilder;
        this.subscription = Subscription.EMPTY;
        this.subscriptionValues = Subscription.EMPTY;
        /**
         * \@docs-private
         */
        this.inputChanges = new Subject();
        this._hasErrors = false;
        /**
         * \@docs-private
         */
        this.currentTextWidth = 0;
        // this will apply different min-widths to our component through our styles
        /**
         * Provide a hint for a minimal width. The actual size will be determined for inputs for each change.
         */
        this.size = 'regular';
    }
    /**
     * @return {?}
     */
    NxWordComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.setupErrorPopover();
    };
    /**
     * @return {?}
     */
    NxWordComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._validateControlChild();
        this.subscription = this._control.stateChanges.pipe(startWith(null)).subscribe((/**
         * @return {?}
         */
        function () {
            _this._hasErrors = _this._control.errorState;
            _this.updateErrorPopoverState();
            _this._changeDetectorRef.markForCheck();
        }));
        // if we have a ngcontrol available stick to its valueChanges subject
        if (this._control.ngControl) {
            this.subscriptionValues = this._control.ngControl.valueChanges.subscribe((/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                _this.updateCurrentTextWidth();
                _this.inputChanges.next();
            }));
            // in any other case it is a bre input and input changes are signaled through simple state changes
        }
        else {
            this.subscriptionValues = this._control.stateChanges.subscribe((/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                _this.updateCurrentTextWidth();
                _this.inputChanges.next();
            }));
        }
        this._control.setAriaLabel(this.label);
    };
    /**
     * @return {?}
     */
    NxWordComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.subscription.unsubscribe();
    };
    /**
      @docs-private
      Calculate the width of the full text given by the input,
      that value is bound to this component so it can grow.
  
      The involved input is known to have a width of 100% an will fit the additional space given
      which completes the auto growing behavior.
    */
    /**
     * \@docs-private
     * Calculate the width of the full text given by the input,
     * that value is bound to this component so it can grow.
     * The involved input is known to have a width of 100% an will fit the additional space given
     * which completes the auto growing behavior.
     * @return {?}
     */
    NxWordComponent.prototype.updateCurrentTextWidth = /**
     * \@docs-private
     * Calculate the width of the full text given by the input,
     * that value is bound to this component so it can grow.
     * The involved input is known to have a width of 100% an will fit the additional space given
     * which completes the auto growing behavior.
     * @return {?}
     */
    function () {
        // provide the canvas only lazy
        if (!this.measureCanvas) {
            this.measureCanvas = this._renderer.createElement('canvas');
        }
        /** @type {?} */
        var ctx = this.measureCanvas.getContext('2d');
        /** @type {?} */
        var inputRef = this._control.elementRef;
        /** @type {?} */
        var styles = window.getComputedStyle(inputRef.nativeElement);
        ctx.font = getFontShorthand(styles);
        /** @type {?} */
        var metrics = ctx.measureText(this._control.value);
        // add 1px (cursor width) to prevent jumping of the text on blur.
        /** @type {?} */
        var newWidth = metrics.width + parseInt(styles.paddingRight, 10) + parseInt(styles.paddingLeft, 10) + 1;
        // This should be injected via @Host to get an exact reference to NxNaturalLanguageFormComponent
        // Works as promised as long as there is not other tag around the word. Not expected but possible.
        /** @type {?} */
        var parent = this.elementRef.nativeElement.parentElement;
        /** @type {?} */
        var parentMeasurement = parent.getBoundingClientRect();
        // Limit to own given minimal width
        this.currentTextWidth = Math.max(parseInt(styles.minWidth, 10), newWidth);
        // Limit to container width
        this.currentTextWidth = Math.min(this.currentTextWidth, parentMeasurement.width);
        if (this._overlayRef.hasAttached()) {
            this._overlayState.positionStrategy.apply();
        }
    };
    /** @docs-private */
    /**
     * \@docs-private
     * @return {?}
     */
    NxWordComponent.prototype.repositionError = /**
     * \@docs-private
     * @return {?}
     */
    function () {
        if (this._overlayRef.hasAttached()) {
            this._overlayState.positionStrategy.apply();
        }
    };
    // Fail if the required control is missing.
    // Fail if the required control is missing.
    /**
     * @protected
     * @return {?}
     */
    NxWordComponent.prototype._validateControlChild = 
    // Fail if the required control is missing.
    /**
     * @protected
     * @return {?}
     */
    function () {
        if (!this._control) {
            throw new Error('NxWordComponent requires an NxFormfieldControl compatible input.');
        }
    };
    /** @docs-private */
    /**
     * \@docs-private
     * @return {?}
     */
    NxWordComponent.prototype.getConnectedOverlayOrigin = /**
     * \@docs-private
     * @return {?}
     */
    function () {
        return this.elementRef;
    };
    Object.defineProperty(NxWordComponent.prototype, "isFocused", {
        /** @docs-private */
        get: /**
         * \@docs-private
         * @return {?}
         */
        function () {
            return this._control.focused;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NxWordComponent.prototype, "isFilled", {
        /** @docs-private */
        get: /**
         * \@docs-private
         * @return {?}
         */
        function () {
            return !this._control.empty;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NxWordComponent.prototype, "hasDropdown", {
        /** @docs-private */
        get: /**
         * \@docs-private
         * @return {?}
         */
        function () {
            return Boolean(this._dropdown);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    NxWordComponent.prototype.updateErrorPopoverState = /**
     * @return {?}
     */
    function () {
        if (this._hasErrors && this._errorChildren.length > 0) {
            this.showPopover();
        }
        else {
            this.hidePopover();
        }
    };
    /**
     * @return {?}
     */
    NxWordComponent.prototype.setupErrorPopover = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var positionStrategy = this._overlayPositionBuilder
            .flexibleConnectedTo(this.elementRef)
            .withLockedPosition(true)
            .withFlexibleDimensions(false)
            .withPush(true)
            .withPositions([{
                originX: 'center',
                originY: 'top',
                overlayX: 'center',
                overlayY: 'bottom'
            },
            {
                originX: 'center',
                originY: 'bottom',
                overlayX: 'center',
                overlayY: 'top'
            }])
            .withDefaultOffsetY(-8);
        this._overlayState = new OverlayConfig();
        this._overlayState.positionStrategy = positionStrategy;
        this._overlayState.scrollStrategy = this._overlay.scrollStrategies.reposition();
        this._overlayRef = this._overlay.create(this._overlayState);
        ((/** @type {?} */ (this._overlayState.positionStrategy))).positionChanges.subscribe((/**
         * @param {?} change
         * @return {?}
         */
        function (change) {
            /** @type {?} */
            var pair = change.connectionPair;
            _this.positionArrow(pair);
            // These position changes arrive too late,
            // We have to trigger the change detection manually
            // as it's detached from any render hierarchy
            // and only updated by the overlay when attached.
            if (_this._embeddedViewRef && !_this._embeddedViewRef.destroyed) {
                _this._embeddedViewRef.detectChanges();
            }
        }));
    };
    /**
     * @private
     * @param {?} pair
     * @return {?}
     */
    NxWordComponent.prototype.positionArrow = /**
     * @private
     * @param {?} pair
     * @return {?}
     */
    function (pair) {
        /** @type {?} */
        var parentElementPositionX = this.elementRef.nativeElement.getBoundingClientRect().left;
        /** @type {?} */
        var parentElementWidth = this.elementRef.nativeElement.getBoundingClientRect().width / 2;
        /** @type {?} */
        var parentElementLeftOffset = this._overlayRef.overlayElement.parentElement.offsetLeft;
        /** @type {?} */
        var overlayElementLeftOffset = this._overlayRef.overlayElement.offsetLeft;
        // calculation for x position of the parent element. In this case, overlay left offset is the one thing to consider.
        /** @type {?} */
        var targetPosition = (parentElementPositionX + parentElementWidth) - (parentElementLeftOffset + overlayElementLeftOffset);
        if (pair.originY === 'top' && pair.overlayY === 'bottom') {
            this._popover.direction = 'top';
        }
        else {
            this._popover.direction = 'bottom';
        }
        this._popover.arrowStyle = { left: targetPosition + 'px' };
    };
    /**
     * @return {?}
     */
    NxWordComponent.prototype.showPopover = /**
     * @return {?}
     */
    function () {
        if (!this._overlayRef.hasAttached()) {
            /** @type {?} */
            var tooltipPortal = new TemplatePortal(this._popover.templateRef, this._viewContainerRef);
            this._embeddedViewRef = this._overlayRef.attach(tooltipPortal);
        }
    };
    /**
     * @return {?}
     */
    NxWordComponent.prototype.hidePopover = /**
     * @return {?}
     */
    function () {
        this._overlayRef.detach();
    };
    NxWordComponent.decorators = [
        { type: Component, args: [{
                    selector: 'nx-word',
                    template: "<div>\n  <!-- We only allow formfield controls here -->\n  <div *ngIf=\"!hasDropdown\" class=\"nx-word__inner-wrapper\">\n    <ng-content select=\"[nxInput]\"></ng-content>\n  </div>\n  <ng-content select=\"nx-dropdown\"></ng-content>\n</div>\n\n<nx-popover #popover>\n  <ng-content select=\"[nxError]\"></ng-content>\n</nx-popover>",
                    host: {
                        '[class.size-short]': 'size == "short"',
                        '[class.size-regular]': 'size == "regular"',
                        '[class.size-long]': 'size == "long"',
                        '[class.has-error]': '_hasErrors',
                        '[class.is-focused]': 'isFocused',
                        '[class.is-filled]': 'isFilled',
                        '[class.has-dropdown]': 'hasDropdown',
                    },
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    styles: [":host{display:inline-block;position:relative;font-weight:400;text-align:center;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;width:100%;margin:0 4px}:host .nx-word__inner-wrapper{border-bottom:2px solid #d9d9d9}:host.size-short{min-width:80px}:host.size-regular{min-width:152px}:host.size-long{min-width:360px}@media (max-width:991px){:host.size-long{min-width:280px}}@media (max-width:703px){:host.size-long{min-width:248px}}:host ::ng-deep .c-input{display:inline-block;text-align:inherit;font-size:inherit;line-height:inherit;background:0 0;color:inherit;border:none;outline:0;margin:0;width:100%;max-width:100%;height:auto;box-shadow:none;padding:0 8px}:host ::ng-deep .c-input.is-focused{outline:0;box-shadow:none}:host ::ng-deep .c-input.is-filled,:host ::ng-deep .c-input.is-focused{color:#006192;color:var(--natural-language-form-active-color,#006192);font-weight:400}:host ::ng-deep .c-input.is-disabled{cursor:not-allowed}:host ::ng-deep .c-input::-ms-clear{display:none}:host ::ng-deep nx-dropdown{position:relative;border-bottom:2px solid #d9d9d9}:host ::ng-deep nx-dropdown .nx-dropdown__container{font-size:inherit;margin-bottom:-2px}:host ::ng-deep nx-dropdown.has-focus,:host ::ng-deep nx-dropdown.is-filled{color:#006192;color:var(--natural-language-form-active-color,#006192);border-color:#007ab3;border-color:var(--natural-language-form-active-border-color,#007ab3)}:host ::ng-deep nx-dropdown .nx-dropdown__icon{line-height:inherit}:host ::ng-deep .nx-word__input-wrapper{width:100%}:host(.is-filled) .nx-word__inner-wrapper,:host(.is-focused) .nx-word__inner-wrapper{border-color:#007ab3;border-color:var(--natural-language-form-active-border-color,#007ab3)}:host(.has-error) .nx-word__inner-wrapper{border-color:#dc3149;border-color:var(--natural-language-form-error-border-color,#dc3149)}:host.has-error ::ng-deep nx-dropdown{color:#dc3149;color:var(--natural-language-form-error-color,#dc3149);border-color:#dc3149;border-color:var(--natural-language-form-error-border-color,#dc3149)}:host.has-error ::ng-deep .c-input.has-error{color:#dc3149;color:var(--natural-language-form-error-color,#dc3149)}:host-context(.is-negative) ::ng-deep .nx-dropdown,:host-context(.is-negative) ::ng-deep nx-dropdown,:host-context(.is-negative) ::ng-deep nx-dropdown.is-filled{border-color:#fff;color:#fff}:host-context(.is-negative) ::ng-deep .c-input,:host-context(.is-negative) ::ng-deep .c-input.has-error{color:#fff}:host-context(.is-negative) .nx-word__inner-wrapper{border-color:#fff}.nx-word__inner-wrapper{height:52px;height:var(--natural-language-form-large-line-height,52px)}@media (max-width:991px){:host ::ng-deep nx-dropdown .nx-dropdown__container{font-size:26px}.nx-word__inner-wrapper{height:36px;height:var(--natural-language-form-small-line-height,36px)}}:host-context(.nx-natural-language-form--small) .nx-word__inner-wrapper{height:36px;height:var(--natural-language-form-small-line-height,36px)}@media screen and (-ms-high-contrast:active){.nx-word__inner-wrapper,::ng-deep nx-dropdown{border-bottom-color:buttonText}}"]
                }] }
    ];
    /** @nocollapse */
    NxWordComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: ChangeDetectorRef },
        { type: Renderer2 },
        { type: Overlay },
        { type: ViewContainerRef },
        { type: OverlayPositionBuilder }
    ]; };
    NxWordComponent.propDecorators = {
        _control: [{ type: ContentChild, args: [NxFormfieldControl, { static: false },] }],
        _errorChildren: [{ type: ContentChildren, args: [NxFormfieldErrorDirective,] }],
        _popover: [{ type: ViewChild, args: ['popover', { static: true },] }],
        _dropdown: [{ type: ContentChild, args: [NxDropdownComponent, { static: false },] }],
        currentTextWidth: [{ type: HostBinding, args: ['style.width.px',] }],
        size: [{ type: Input, args: ['nxSize',] }],
        label: [{ type: Input, args: ['nxLabel',] }]
    };
    return NxWordComponent;
}());
export { NxWordComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype.subscription;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype.subscriptionValues;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype.measureCanvas;
    /**
     * \@docs-private
     * @type {?}
     */
    NxWordComponent.prototype.inputChanges;
    /** @type {?} */
    NxWordComponent.prototype._hasErrors;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype._overlayRef;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype._embeddedViewRef;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype._overlayState;
    /** @type {?} */
    NxWordComponent.prototype._control;
    /** @type {?} */
    NxWordComponent.prototype._errorChildren;
    /** @type {?} */
    NxWordComponent.prototype._popover;
    /** @type {?} */
    NxWordComponent.prototype._dropdown;
    /**
     * \@docs-private
     * @type {?}
     */
    NxWordComponent.prototype.currentTextWidth;
    /**
     * Provide a hint for a minimal width. The actual size will be determined for inputs for each change.
     * @type {?}
     */
    NxWordComponent.prototype.size;
    /**
     * A word doesn't have a set place to show labels.
     * In order to be accessible, you have to provide a label with this property.
     * It will be attached to the given input through `aria-label`.
     * @type {?}
     */
    NxWordComponent.prototype.label;
    /**
     * \@docs-private
     * @type {?}
     */
    NxWordComponent.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype._changeDetectorRef;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype._renderer;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype._overlay;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype._viewContainerRef;
    /**
     * @type {?}
     * @private
     */
    NxWordComponent.prototype._overlayPositionBuilder;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29yZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxsaWFuei9uZ3gtbmRieC8iLCJzb3VyY2VzIjpbIm5hdHVyYWwtbGFuZ3VhZ2UtZm9ybS93b3JkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSx5QkFBeUIsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzVGLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQzNELE9BQU8sRUFBRSxPQUFPLEVBQUUsYUFBYSxFQUFFLHNCQUFzQixFQUNrQixNQUFNLHNCQUFzQixDQUFDO0FBQ3RHLE9BQU8sRUFFTCx1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxZQUFZLEVBQ1osZUFBZSxFQUNmLFVBQVUsRUFDVixXQUFXLEVBQ1gsS0FBSyxFQUVMLFNBQVMsRUFDVCxTQUFTLEVBQ1QsU0FBUyxFQUNULGdCQUFnQixFQUdqQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLE9BQU8sRUFBSSxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFL0MsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDL0QsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDakUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBS3JEO0lBb0RFLHlCQUVTLFVBQXNCLEVBQ3JCLGtCQUFxQyxFQUNyQyxTQUFvQixFQUNwQixRQUFpQixFQUNqQixpQkFBbUMsRUFDbkMsdUJBQStDO1FBTGhELGVBQVUsR0FBVixVQUFVLENBQVk7UUFDckIsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFtQjtRQUNyQyxjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQ3BCLGFBQVEsR0FB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QUUsVUFBVTt3QkFDL0Isc0JBQXNCLEVBQUUsYUFBYTtxQkFFdEM7b0JBQ0QsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07O2lCQUNoRDs7OztnQkF0Q0MsVUFBVTtnQkFKVixpQkFBaUI7Z0JBU2pCLFNBQVM7Z0JBZEYsT0FBTztnQkFnQmQsZ0JBQWdCO2dCQWhCZSxzQkFBc0I7OzsyQkE4RHBELFlBQVksU0FBQyxrQkFBa0IsRUFBRSxFQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUM7aUNBQ2hELGVBQWUsU0FBQyx5QkFBeUI7MkJBQ3pDLFNBQVMsU0FBQyxTQUFTLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzRCQUNyQyxZQUFZLFNBQUMsbUJBQW1CLEVBQUUsRUFBQyxNQUFNLEVBQUUsS0FBSyxFQUFDO21DQUdqRCxXQUFXLFNBQUMsZ0JBQWdCO3VCQUs1QixLQUFLLFNBQUMsUUFBUTt3QkFPZCxLQUFLLFNBQUMsU0FBUzs7SUFrTWxCLHNCQUFDO0NBQUEsQUFwUEQsSUFvUEM7U0FqT1ksZUFBZTs7Ozs7O0lBQzFCLHVDQUF3RDs7Ozs7SUFDeEQsNkNBQThEOzs7OztJQUM5RCx3Q0FBeUM7Ozs7O0lBR3pDLHVDQUFrQzs7SUFFbEMscUNBQTRCOzs7OztJQUM1QixzQ0FBZ0M7Ozs7O0lBQ2hDLDJDQUErQzs7Ozs7SUFDL0Msd0NBQXFDOztJQUVyQyxtQ0FBcUY7O0lBQ3JGLHlDQUFpRzs7SUFDakcsbUNBQXFFOztJQUNyRSxvQ0FBbUY7Ozs7O0lBR25GLDJDQUM2Qjs7Ozs7SUFJN0IsK0JBQXlDOzs7Ozs7O0lBT3pDLGdDQUFnQzs7Ozs7SUFJOUIscUNBQTZCOzs7OztJQUM3Qiw2Q0FBNkM7Ozs7O0lBQzdDLG9DQUE0Qjs7Ozs7SUFDNUIsbUNBQXlCOzs7OztJQUN6Qiw0Q0FBMkM7Ozs7O0lBQzNDLGtEQUF1RCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE54Rm9ybWZpZWxkQ29udHJvbCwgTnhGb3JtZmllbGRFcnJvckRpcmVjdGl2ZSB9IGZyb20gJ0BhbGxpYW56L25neC1uZGJ4L2Zvcm1maWVsZCc7XG5pbXBvcnQgeyBnZXRGb250U2hvcnRoYW5kIH0gZnJvbSAnQGFsbGlhbnovbmd4LW5kYngvdXRpbHMnO1xuaW1wb3J0IHsgT3ZlcmxheSwgT3ZlcmxheUNvbmZpZywgT3ZlcmxheVBvc2l0aW9uQnVpbGRlcixcbiAgT3ZlcmxheVJlZiwgRmxleGlibGVDb25uZWN0ZWRQb3NpdGlvblN0cmF0ZWd5LCBDb25uZWN0aW9uUG9zaXRpb25QYWlyIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL292ZXJsYXknO1xuaW1wb3J0IHtcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBFbGVtZW50UmVmLFxuICBIb3N0QmluZGluZyxcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgUXVlcnlMaXN0LFxuICBSZW5kZXJlcjIsXG4gIFZpZXdDaGlsZCxcbiAgVmlld0NvbnRhaW5lclJlZixcbiAgRW1iZWRkZWRWaWV3UmVmLFxuICBPbkluaXRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBzdGFydFdpdGggfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBTdWJqZWN0ICwgIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBOeFBvcG92ZXJDb21wb25lbnQgfSBmcm9tICdAYWxsaWFuei9uZ3gtbmRieC9wb3BvdmVyJztcbmltcG9ydCB7IE54RHJvcGRvd25Db21wb25lbnQgfSBmcm9tICdAYWxsaWFuei9uZ3gtbmRieC9kcm9wZG93bic7XG5pbXBvcnQgeyBUZW1wbGF0ZVBvcnRhbCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9wb3J0YWwnO1xuXG4vKiogVHlwZSB0byBkZXRlcm1pbmUgdGhlIG1pbmltYWwgd2lkdGggb2YgYSB3b3JkLiAqL1xuZXhwb3J0IHR5cGUgU0laRVMgPSAncmVndWxhcicgfCAnc2hvcnQnIHwgJ2xvbmcnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdueC13b3JkJyxcbiAgdGVtcGxhdGVVcmw6ICd3b3JkLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbXG4gICAgJ3dvcmQuY29tcG9uZW50LnNjc3MnXG4gIF0sXG4gIGhvc3Q6IHtcbiAgICAnW2NsYXNzLnNpemUtc2hvcnRdJzogJ3NpemUgPT0gXCJzaG9ydFwiJyxcbiAgICAnW2NsYXNzLnNpemUtcmVndWxhcl0nOiAnc2l6ZSA9PSBcInJlZ3VsYXJcIicsXG4gICAgJ1tjbGFzcy5zaXplLWxvbmddJzogJ3NpemUgPT0gXCJsb25nXCInLFxuICAgICdbY2xhc3MuaGFzLWVycm9yXSc6ICdfaGFzRXJyb3JzJyxcbiAgICAnW2NsYXNzLmlzLWZvY3VzZWRdJzogJ2lzRm9jdXNlZCcsXG4gICAgJ1tjbGFzcy5pcy1maWxsZWRdJzogJ2lzRmlsbGVkJyxcbiAgICAnW2NsYXNzLmhhcy1kcm9wZG93bl0nOiAnaGFzRHJvcGRvd24nLFxuXG4gIH0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcblxuZXhwb3J0IGNsYXNzIE54V29yZENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQsIE9uRGVzdHJveSwgT25Jbml0IHtcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbiA9IFN1YnNjcmlwdGlvbi5FTVBUWTtcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb25WYWx1ZXM6IFN1YnNjcmlwdGlvbiA9IFN1YnNjcmlwdGlvbi5FTVBUWTtcbiAgcHJpdmF0ZSBtZWFzdXJlQ2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudDtcblxuICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICBpbnB1dENoYW5nZXMgPSBuZXcgU3ViamVjdDxhbnk+KCk7XG5cbiAgX2hhc0Vycm9yczogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIF9vdmVybGF5UmVmOiBPdmVybGF5UmVmO1xuICBwcml2YXRlIF9lbWJlZGRlZFZpZXdSZWY6IEVtYmVkZGVkVmlld1JlZjxhbnk+O1xuICBwcml2YXRlIF9vdmVybGF5U3RhdGU6IE92ZXJsYXlDb25maWc7XG5cbiAgQENvbnRlbnRDaGlsZChOeEZvcm1maWVsZENvbnRyb2wsIHtzdGF0aWM6IGZhbHNlfSkgX2NvbnRyb2w6IE54Rm9ybWZpZWxkQ29udHJvbDxhbnk+O1xuICBAQ29udGVudENoaWxkcmVuKE54Rm9ybWZpZWxkRXJyb3JEaXJlY3RpdmUpIF9lcnJvckNoaWxkcmVuOiBRdWVyeUxpc3Q8TnhGb3JtZmllbGRFcnJvckRpcmVjdGl2ZT47XG4gIEBWaWV3Q2hpbGQoJ3BvcG92ZXInLCB7IHN0YXRpYzogdHJ1ZSB9KSBfcG9wb3ZlcjogTnhQb3BvdmVyQ29tcG9uZW50O1xuICBAQ29udGVudENoaWxkKE54RHJvcGRvd25Db21wb25lbnQsIHtzdGF0aWM6IGZhbHNlfSkgX2Ryb3Bkb3duOiBOeERyb3Bkb3duQ29tcG9uZW50O1xuXG4gIC8qKiBAZG9jcy1wcml2YXRlICovXG4gIEBIb3N0QmluZGluZygnc3R5bGUud2lkdGgucHgnKVxuICBjdXJyZW50VGV4dFdpZHRoOiBudW1iZXIgPSAwO1xuXG4gIC8vIHRoaXMgd2lsbCBhcHBseSBkaWZmZXJlbnQgbWluLXdpZHRocyB0byBvdXIgY29tcG9uZW50IHRocm91Z2ggb3VyIHN0eWxlc1xuICAvKiogUHJvdmlkZSBhIGhpbnQgZm9yIGEgbWluaW1hbCB3aWR0aC4gVGhlIGFjdHVhbCBzaXplIHdpbGwgYmUgZGV0ZXJtaW5lZCBmb3IgaW5wdXRzIGZvciBlYWNoIGNoYW5nZS4gKi9cbiAgQElucHV0KCdueFNpemUnKSBzaXplOiBTSVpFUyA9ICdyZWd1bGFyJztcblxuICAvKipcbiAgICogQSB3b3JkIGRvZXNuJ3QgaGF2ZSBhIHNldCBwbGFjZSB0byBzaG93IGxhYmVscy5cbiAgICogSW4gb3JkZXIgdG8gYmUgYWNjZXNzaWJsZSwgeW91IGhhdmUgdG8gcHJvdmlkZSBhIGxhYmVsIHdpdGggdGhpcyBwcm9wZXJ0eS5cbiAgICogSXQgd2lsbCBiZSBhdHRhY2hlZCB0byB0aGUgZ2l2ZW4gaW5wdXQgdGhyb3VnaCBgYXJpYS1sYWJlbGAuXG4gICAqL1xuICBASW5wdXQoJ254TGFiZWwnKSBsYWJlbDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBAZG9jcy1wcml2YXRlICovXG4gICAgcHVibGljIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXG4gICAgcHJpdmF0ZSBfY2hhbmdlRGV0ZWN0b3JSZWY6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgX3JlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgcHJpdmF0ZSBfb3ZlcmxheTogT3ZlcmxheSxcbiAgICBwcml2YXRlIF92aWV3Q29udGFpbmVyUmVmOiBWaWV3Q29udGFpbmVyUmVmLFxuICAgIHByaXZhdGUgX292ZXJsYXlQb3NpdGlvbkJ1aWxkZXI6IE92ZXJsYXlQb3NpdGlvbkJ1aWxkZXJcbiAgKSB7IH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnNldHVwRXJyb3JQb3BvdmVyKCk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgdGhpcy5fdmFsaWRhdGVDb250cm9sQ2hpbGQoKTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbiA9IHRoaXMuX2NvbnRyb2wuc3RhdGVDaGFuZ2VzLnBpcGUoc3RhcnRXaXRoKG51bGwpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5faGFzRXJyb3JzID0gdGhpcy5fY29udHJvbC5lcnJvclN0YXRlO1xuICAgICAgdGhpcy51cGRhdGVFcnJvclBvcG92ZXJTdGF0ZSgpO1xuICAgICAgdGhpcy5fY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XG4gICAgfSk7XG5cbiAgICAvLyBpZiB3ZSBoYXZlIGEgbmdjb250cm9sIGF2YWlsYWJsZSBzdGljayB0byBpdHMgdmFsdWVDaGFuZ2VzIHN1YmplY3RcbiAgICBpZiAodGhpcy5fY29udHJvbC5uZ0NvbnRyb2wpIHtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uVmFsdWVzID0gdGhpcy5fY29udHJvbC5uZ0NvbnRyb2wudmFsdWVDaGFuZ2VzLnN1YnNjcmliZSh2YWx1ZSA9PiB7XG4gICAgICAgIHRoaXMudXBkYXRlQ3VycmVudFRleHRXaWR0aCgpO1xuICAgICAgICB0aGlzLmlucHV0Q2hhbmdlcy5uZXh0KCk7XG4gICAgICB9KTtcbiAgICAvLyBpbiBhbnkgb3RoZXIgY2FzZSBpdCBpcyBhIGJyZSBpbnB1dCBhbmQgaW5wdXQgY2hhbmdlcyBhcmUgc2lnbmFsZWQgdGhyb3VnaCBzaW1wbGUgc3RhdGUgY2hhbmdlc1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvblZhbHVlcyA9IHRoaXMuX2NvbnRyb2wuc3RhdGVDaGFuZ2VzLnN1YnNjcmliZSh2YWx1ZSA9PiB7XG4gICAgICAgIHRoaXMudXBkYXRlQ3VycmVudFRleHRXaWR0aCgpO1xuICAgICAgICB0aGlzLmlucHV0Q2hhbmdlcy5uZXh0KCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLl9jb250cm9sLnNldEFyaWFMYWJlbCh0aGlzLmxhYmVsKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICAvKipcbiAgICBAZG9jcy1wcml2YXRlXG4gICAgQ2FsY3VsYXRlIHRoZSB3aWR0aCBvZiB0aGUgZnVsbCB0ZXh0IGdpdmVuIGJ5IHRoZSBpbnB1dCxcbiAgICB0aGF0IHZhbHVlIGlzIGJvdW5kIHRvIHRoaXMgY29tcG9uZW50IHNvIGl0IGNhbiBncm93LlxuXG4gICAgVGhlIGludm9sdmVkIGlucHV0IGlzIGtub3duIHRvIGhhdmUgYSB3aWR0aCBvZiAxMDAlIGFuIHdpbGwgZml0IHRoZSBhZGRpdGlvbmFsIHNwYWNlIGdpdmVuXG4gICAgd2hpY2ggY29tcGxldGVzIHRoZSBhdXRvIGdyb3dpbmcgYmVoYXZpb3IuXG4gICovXG4gIHVwZGF0ZUN1cnJlbnRUZXh0V2lkdGgoKSB7XG4gICAgLy8gcHJvdmlkZSB0aGUgY2FudmFzIG9ubHkgbGF6eVxuICAgIGlmICghdGhpcy5tZWFzdXJlQ2FudmFzKSB7XG4gICAgICB0aGlzLm1lYXN1cmVDYW52YXMgPSB0aGlzLl9yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICB9XG5cbiAgICBjb25zdCBjdHggPSB0aGlzLm1lYXN1cmVDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICBjb25zdCBpbnB1dFJlZiA9IHRoaXMuX2NvbnRyb2wuZWxlbWVudFJlZjtcbiAgICBjb25zdCBzdHlsZXMgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShpbnB1dFJlZi5uYXRpdmVFbGVtZW50KTtcbiAgICBjdHguZm9udCA9IGdldEZvbnRTaG9ydGhhbmQoc3R5bGVzKTtcblxuICAgIGNvbnN0IG1ldHJpY3MgPSBjdHgubWVhc3VyZVRleHQodGhpcy5fY29udHJvbC52YWx1ZSk7XG4gICAgLy8gYWRkIDFweCAoY3Vyc29yIHdpZHRoKSB0byBwcmV2ZW50IGp1bXBpbmcgb2YgdGhlIHRleHQgb24gYmx1ci5cbiAgICBjb25zdCBuZXdXaWR0aCA9IG1ldHJpY3Mud2lkdGggKyBwYXJzZUludChzdHlsZXMucGFkZGluZ1JpZ2h0LCAxMCkgKyBwYXJzZUludChzdHlsZXMucGFkZGluZ0xlZnQsIDEwKSArIDE7XG5cbiAgICAvLyBUaGlzIHNob3VsZCBiZSBpbmplY3RlZCB2aWEgQEhvc3QgdG8gZ2V0IGFuIGV4YWN0IHJlZmVyZW5jZSB0byBOeE5hdHVyYWxMYW5ndWFnZUZvcm1Db21wb25lbnRcbiAgICAvLyBXb3JrcyBhcyBwcm9taXNlZCBhcyBsb25nIGFzIHRoZXJlIGlzIG5vdCBvdGhlciB0YWcgYXJvdW5kIHRoZSB3b3JkLiBOb3QgZXhwZWN0ZWQgYnV0IHBvc3NpYmxlLlxuICAgIGNvbnN0IHBhcmVudDogSFRNTEVsZW1lbnQgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5wYXJlbnRFbGVtZW50O1xuICAgIGNvbnN0IHBhcmVudE1lYXN1cmVtZW50ID0gcGFyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgLy8gTGltaXQgdG8gb3duIGdpdmVuIG1pbmltYWwgd2lkdGhcbiAgICB0aGlzLmN1cnJlbnRUZXh0V2lkdGggPSBNYXRoLm1heChwYXJzZUludChzdHlsZXMubWluV2lkdGgsIDEwKSwgbmV3V2lkdGgpO1xuXG4gICAgLy8gTGltaXQgdG8gY29udGFpbmVyIHdpZHRoXG4gICAgdGhpcy5jdXJyZW50VGV4dFdpZHRoID0gTWF0aC5taW4odGhpcy5jdXJyZW50VGV4dFdpZHRoLCBwYXJlbnRNZWFzdXJlbWVudC53aWR0aCk7XG5cbiAgICBpZiAodGhpcy5fb3ZlcmxheVJlZi5oYXNBdHRhY2hlZCgpKSB7XG4gICAgICB0aGlzLl9vdmVybGF5U3RhdGUucG9zaXRpb25TdHJhdGVneS5hcHBseSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBAZG9jcy1wcml2YXRlICovXG4gIHJlcG9zaXRpb25FcnJvcigpIHtcbiAgICBpZiAodGhpcy5fb3ZlcmxheVJlZi5oYXNBdHRhY2hlZCgpKSB7XG4gICAgICB0aGlzLl9vdmVybGF5U3RhdGUucG9zaXRpb25TdHJhdGVneS5hcHBseSgpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEZhaWwgaWYgdGhlIHJlcXVpcmVkIGNvbnRyb2wgaXMgbWlzc2luZy5cbiAgcHJvdGVjdGVkIF92YWxpZGF0ZUNvbnRyb2xDaGlsZCgpIHtcbiAgICBpZiAoIXRoaXMuX2NvbnRyb2wpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTnhXb3JkQ29tcG9uZW50IHJlcXVpcmVzIGFuIE54Rm9ybWZpZWxkQ29udHJvbCBjb21wYXRpYmxlIGlucHV0LicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBAZG9jcy1wcml2YXRlICovXG4gIGdldENvbm5lY3RlZE92ZXJsYXlPcmlnaW4oKTogRWxlbWVudFJlZiB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudFJlZjtcbiAgfVxuXG4gIC8qKiBAZG9jcy1wcml2YXRlICovXG4gIGdldCBpc0ZvY3VzZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbnRyb2wuZm9jdXNlZDtcbiAgfVxuXG4gIC8qKiBAZG9jcy1wcml2YXRlICovXG4gIGdldCBpc0ZpbGxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gIXRoaXMuX2NvbnRyb2wuZW1wdHk7XG4gIH1cblxuICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICBnZXQgaGFzRHJvcGRvd24oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIEJvb2xlYW4odGhpcy5fZHJvcGRvd24pO1xuICB9XG5cbiAgdXBkYXRlRXJyb3JQb3BvdmVyU3RhdGUoKSB7XG4gICAgaWYgKHRoaXMuX2hhc0Vycm9ycyAmJiB0aGlzLl9lcnJvckNoaWxkcmVuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhpcy5zaG93UG9wb3ZlcigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5oaWRlUG9wb3ZlcigpO1xuICAgIH1cbiAgfVxuXG4gIHNldHVwRXJyb3JQb3BvdmVyKCkge1xuICAgIGNvbnN0IHBvc2l0aW9uU3RyYXRlZ3kgPSB0aGlzLl9vdmVybGF5UG9zaXRpb25CdWlsZGVyXG4gICAgICAuZmxleGlibGVDb25uZWN0ZWRUbyh0aGlzLmVsZW1lbnRSZWYpXG4gICAgICAud2l0aExvY2tlZFBvc2l0aW9uKHRydWUpXG4gICAgICAud2l0aEZsZXhpYmxlRGltZW5zaW9ucyhmYWxzZSlcbiAgICAgIC53aXRoUHVzaCh0cnVlKVxuICAgICAgLndpdGhQb3NpdGlvbnMoW3tcbiAgICAgICAgb3JpZ2luWDogJ2NlbnRlcicsXG4gICAgICAgIG9yaWdpblk6ICd0b3AnLFxuICAgICAgICBvdmVybGF5WDogJ2NlbnRlcicsXG4gICAgICAgIG92ZXJsYXlZOiAnYm90dG9tJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgb3JpZ2luWDogJ2NlbnRlcicsXG4gICAgICAgIG9yaWdpblk6ICdib3R0b20nLFxuICAgICAgICBvdmVybGF5WDogJ2NlbnRlcicsXG4gICAgICAgIG92ZXJsYXlZOiAndG9wJ1xuICAgICAgfV0pXG4gICAgICAud2l0aERlZmF1bHRPZmZzZXRZKC04KTtcblxuICAgIHRoaXMuX292ZXJsYXlTdGF0ZSA9IG5ldyBPdmVybGF5Q29uZmlnKCk7XG4gICAgdGhpcy5fb3ZlcmxheVN0YXRlLnBvc2l0aW9uU3RyYXRlZ3kgPSBwb3NpdGlvblN0cmF0ZWd5O1xuICAgIHRoaXMuX292ZXJsYXlTdGF0ZS5zY3JvbGxTdHJhdGVneSA9IHRoaXMuX292ZXJsYXkuc2Nyb2xsU3RyYXRlZ2llcy5yZXBvc2l0aW9uKCk7XG4gICAgdGhpcy5fb3ZlcmxheVJlZiA9IHRoaXMuX292ZXJsYXkuY3JlYXRlKHRoaXMuX292ZXJsYXlTdGF0ZSk7XG5cbiAgICAodGhpcy5fb3ZlcmxheVN0YXRlLnBvc2l0aW9uU3RyYXRlZ3kgYXMgRmxleGlibGVDb25uZWN0ZWRQb3NpdGlvblN0cmF0ZWd5KS5wb3NpdGlvbkNoYW5nZXMuc3Vic2NyaWJlKGNoYW5nZSA9PiB7XG4gICAgICBjb25zdCBwYWlyID0gY2hhbmdlLmNvbm5lY3Rpb25QYWlyO1xuICAgICAgdGhpcy5wb3NpdGlvbkFycm93KHBhaXIpO1xuXG4gICAgICAvLyBUaGVzZSBwb3NpdGlvbiBjaGFuZ2VzIGFycml2ZSB0b28gbGF0ZSxcbiAgICAgIC8vIFdlIGhhdmUgdG8gdHJpZ2dlciB0aGUgY2hhbmdlIGRldGVjdGlvbiBtYW51YWxseVxuICAgICAgLy8gYXMgaXQncyBkZXRhY2hlZCBmcm9tIGFueSByZW5kZXIgaGllcmFyY2h5XG4gICAgICAvLyBhbmQgb25seSB1cGRhdGVkIGJ5IHRoZSBvdmVybGF5IHdoZW4gYXR0YWNoZWQuXG4gICAgICBpZiAodGhpcy5fZW1iZWRkZWRWaWV3UmVmICYmICF0aGlzLl9lbWJlZGRlZFZpZXdSZWYuZGVzdHJveWVkKSB7XG4gICAgICAgIHRoaXMuX2VtYmVkZGVkVmlld1JlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICB9XG4gICAgfVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIHBvc2l0aW9uQXJyb3cocGFpcjogQ29ubmVjdGlvblBvc2l0aW9uUGFpcikge1xuICAgIGNvbnN0IHBhcmVudEVsZW1lbnRQb3NpdGlvblggPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0O1xuICAgIGNvbnN0IHBhcmVudEVsZW1lbnRXaWR0aCA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoIC8gMjtcbiAgICBjb25zdCBwYXJlbnRFbGVtZW50TGVmdE9mZnNldCA9IHRoaXMuX292ZXJsYXlSZWYub3ZlcmxheUVsZW1lbnQucGFyZW50RWxlbWVudC5vZmZzZXRMZWZ0O1xuICAgIGNvbnN0IG92ZXJsYXlFbGVtZW50TGVmdE9mZnNldCA9IHRoaXMuX292ZXJsYXlSZWYub3ZlcmxheUVsZW1lbnQub2Zmc2V0TGVmdDtcblxuICAgIC8vIGNhbGN1bGF0aW9uIGZvciB4IHBvc2l0aW9uIG9mIHRoZSBwYXJlbnQgZWxlbWVudC4gSW4gdGhpcyBjYXNlLCBvdmVybGF5IGxlZnQgb2Zmc2V0IGlzIHRoZSBvbmUgdGhpbmcgdG8gY29uc2lkZXIuXG4gICAgY29uc3QgdGFyZ2V0UG9zaXRpb24gPSAocGFyZW50RWxlbWVudFBvc2l0aW9uWCArIHBhcmVudEVsZW1lbnRXaWR0aCkgLSAocGFyZW50RWxlbWVudExlZnRPZmZzZXQgKyBvdmVybGF5RWxlbWVudExlZnRPZmZzZXQpO1xuXG4gICAgaWYgKHBhaXIub3JpZ2luWSA9PT0gJ3RvcCcgJiYgcGFpci5vdmVybGF5WSA9PT0gJ2JvdHRvbScpIHtcbiAgICAgIHRoaXMuX3BvcG92ZXIuZGlyZWN0aW9uID0gJ3RvcCc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3BvcG92ZXIuZGlyZWN0aW9uID0gJ2JvdHRvbSc7XG4gICAgfVxuXG4gICAgdGhpcy5fcG9wb3Zlci5hcnJvd1N0eWxlID0ge2xlZnQ6IHRhcmdldFBvc2l0aW9uICsgJ3B4J307XG4gIH1cblxuICBzaG93UG9wb3ZlcigpIHtcbiAgICBpZiAoIXRoaXMuX292ZXJsYXlSZWYuaGFzQXR0YWNoZWQoKSkge1xuICAgICAgY29uc3QgdG9vbHRpcFBvcnRhbCA9IG5ldyBUZW1wbGF0ZVBvcnRhbCh0aGlzLl9wb3BvdmVyLnRlbXBsYXRlUmVmLCB0aGlzLl92aWV3Q29udGFpbmVyUmVmKTtcbiAgICAgIHRoaXMuX2VtYmVkZGVkVmlld1JlZiA9IHRoaXMuX292ZXJsYXlSZWYuYXR0YWNoKHRvb2x0aXBQb3J0YWwpO1xuICAgIH1cbiAgfVxuXG4gIGhpZGVQb3BvdmVyKCkge1xuICAgIHRoaXMuX292ZXJsYXlSZWYuZGV0YWNoKCk7XG4gIH1cbn1cbiJdfQ==